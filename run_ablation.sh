#!/bin/bash
#PBS -l walltime=80:15:00
#PBS -l nodes=1:ppn=2:gpus=1,mem=100GB
#PBS -A PAS2099
#PBS -N jike338
#PBS -j oe
#PBS -m be
#SBATCH --output=script_output1/R-%x.%j.out
module load python
module load cuda


cd /fs/ess/scratch/PAS2099/jike/DelayBN




# NON-IID
#alpha = 0(shards), 0.1, 0.6, 100(iid)

#* tiny
#** delay
# python3 main_fl_clean.py --dataset tiny --data /fs/scratch/PAS2099/pfl_final/data_/data/tiny-imagenet-200 -a resnet18 --print-freq 100 --steps 100 -b 20 --frac 0.5 --method step --alpha 0 --rounds 1255 --freeze_bn_at_round 628 --num_data 98000 --lr 0.02 --num_users 10 --norm_layer BatchNorm --probe_activs --id tiny_output/tensorboard/resnet18_bn_step100_delay_noniid0 > tiny_output/resnet18_bn_step100_delay_noniid0.txt
# python3 main_fl_clean.py --dataset tiny --data /fs/scratch/PAS2099/pfl_final/data_/data/tiny-imagenet-200 -a resnet18 --print-freq 100 --steps 100 -b 20 --frac 0.5 --method dir --alpha 0.1 --rounds 1255 --freeze_bn_at_round 628 --num_data 98000 --lr 0.02 --num_users 10 --norm_layer BatchNorm --probe_activs --id tiny_output/tensorboard/resnet18_bn_step100_delay_noniid01 > tiny_output/resnet18_bn_step100_delay_noniid01.txt
# python3 main_fl_clean.py --dataset tiny --data /fs/scratch/PAS2099/pfl_final/data_/data/tiny-imagenet-200 -a resnet18 --print-freq 100 --steps 100 -b 20 --frac 0.5 --method dir --alpha 0.6 --rounds 1255 --freeze_bn_at_round 628 --num_data 98000 --lr 0.02 --num_users 10 --norm_layer BatchNorm --probe_activs --id tiny_output/tensorboard/resnet18_bn_step100_delay_noniid06 > tiny_output/resnet18_bn_step100_delay_noniid06.txt
# python3 main_fl_clean.py --dataset tiny --data /fs/scratch/PAS2099/pfl_final/data_/data/tiny-imagenet-200 -a resnet18 --print-freq 100 --steps 100 -b 20 --frac 0.5 --method dir --alpha 100 --rounds 1255 --freeze_bn_at_round 628 --num_data 98000 --lr 0.02 --num_users 10 --norm_layer BatchNorm --probe_activs --id tiny_output/tensorboard/resnet18_bn_step100_delay_noniid100 > tiny_output/resnet18_bn_step100_delay_noniid100.txt

# #* cifar

# #** delay
# python3 main_fl_clean.py --dataset cifar10 -a resnet18 --print-freq 100 --steps 100 -b 20 --frac 0.5 --method step --alpha 0 --rounds 640 --freeze_bn_at_round 320 --num_classes 10 --num_data 49000 --lr 0.02 --num_users 10 --norm_layer BatchNorm --probe_activs --id ablation_main/tensorboard/resnet18_bn_cifar10_delay_noniid0 > ablation_main/resnet18_bn_cifar10_delay_noniid0.txt
# python3 main_fl_clean.py --dataset cifar10 -a resnet18 --print-freq 100 --steps 100 -b 20 --frac 0.5 --method dir --alpha 0.1 --rounds 640 --freeze_bn_at_round 320 --num_classes 10 --num_data 49000 --lr 0.02 --num_users 10 --norm_layer BatchNorm --probe_activs --id ablation_main/tensorboard/resnet18_bn_cifar10_delay_noniid01 > ablation_main/resnet18_bn_cifar10_delay_noniid01.txt
# python3 main_fl_clean.py --dataset cifar10 -a resnet18 --print-freq 100 --steps 100 -b 20 --frac 0.5 --method dir --alpha 0.6 --rounds 640 --freeze_bn_at_round 320 --num_classes 10 --num_data 49000 --lr 0.02 --num_users 10 --norm_layer BatchNorm --probe_activs --id ablation_main/tensorboard/resnet18_bn_cifar10_delay_noniid06 > ablation_main/resnet18_bn_cifar10_delay_noniid06.txt
# python3 main_fl_clean.py --dataset cifar10 -a resnet18 --print-freq 100 --steps 100 -b 20 --frac 0.5 --method dir --alpha 100 --rounds 640 --freeze_bn_at_round 320 --num_classes 10 --num_data 49000 --lr 0.02 --num_users 10 --norm_layer BatchNorm --probe_activs --id ablation_main/tensorboard/resnet18_bn_cifar10_delay_noniid100 > ablation_main/resnet18_bn_cifar10_delay_noniid100.txt

# #** regular BN
# python3 main_fl_clean.py --dataset cifar10 -a resnet18 --print-freq 100 --steps 100 -b 20 --frac 0.5 --method step --alpha 0 --rounds 640 --num_classes 10 --num_data 49000 --lr 0.02 --num_users 10 --norm_layer BatchNorm --probe_activs --id ablation_main/tensorboard/resnet18_bn_cifar10_noniid0 > ablation_main/resnet18_bn_cifar10_noniid0.txt
# python3 main_fl_clean.py --dataset cifar10 -a resnet18 --print-freq 100 --steps 100 -b 20 --frac 0.5 --method dir --alpha 0.1 --rounds 640 --num_classes 10 --num_data 49000 --lr 0.02 --num_users 10 --norm_layer BatchNorm --probe_activs --id ablation_main/tensorboard/resnet18_bn_cifar10_noniid01 > ablation_main/resnet18_bn_cifar10_noniid01.txt
# python3 main_fl_clean.py --dataset cifar10 -a resnet18 --print-freq 100 --steps 100 -b 20 --frac 0.5 --method dir --alpha 0.6 --rounds 640 --num_classes 10 --num_data 49000 --lr 0.02 --num_users 10 --norm_layer BatchNorm --probe_activs --id ablation_main/tensorboard/resnet18_bn_cifar10_noniid06 > ablation_main/resnet18_bn_cifar10_noniid06.txt
# python3 main_fl_clean.py --dataset cifar10 -a resnet18 --print-freq 100 --steps 100 -b 20 --frac 0.5 --method dir --alpha 100 --rounds 640 --num_classes 10 --num_data 49000 --lr 0.02 --num_users 10 --norm_layer BatchNorm --probe_activs --id ablation_main/tensorboard/resnet18_bn_cifar10_noniid100 > ablation_main/resnet18_bn_cifar10_noniid100.txt

# #** regular GN
# python3 main_fl_clean.py --dataset cifar10 -a resnet18 --print-freq 100 --steps 100 -b 20 --frac 0.5 --method step --alpha 0 --rounds 640 --num_classes 10 --num_data 49000 --lr 0.02 --num_users 10 --norm_layer GroupNorm --probe_activs --id ablation_main/tensorboard/resnet18_gn_cifar10_noniid0 > ablation_main/resnet18_gn_cifar10_noniid0.txt
# python3 main_fl_clean.py --dataset cifar10 -a resnet18 --print-freq 100 --steps 100 -b 20 --frac 0.5 --method dir --alpha 0.1 --rounds 640 --num_classes 10 --num_data 49000 --lr 0.02 --num_users 10 --norm_layer GroupNorm --probe_activs --id ablation_main/tensorboard/resnet18_gn_cifar10_noniid01 > ablation_main/resnet18_gn_cifar10_noniid01.txt
# python3 main_fl_clean.py --dataset cifar10 -a resnet18 --print-freq 100 --steps 100 -b 20 --frac 0.5 --method dir --alpha 0.6 --rounds 640 --num_classes 10 --num_data 49000 --lr 0.02 --num_users 10 --norm_layer GroupNorm --probe_activs --id ablation_main/tensorboard/resnet18_gn_cifar10_noniid06 > ablation_main/resnet18_gn_cifar10_noniid06.txt
# python3 main_fl_clean.py --dataset cifar10 -a resnet18 --print-freq 100 --steps 100 -b 20 --frac 0.5 --method dir --alpha 100 --rounds 640 --num_classes 10 --num_data 49000 --lr 0.02 --num_users 10 --norm_layer GroupNorm --probe_activs --id ablation_main/tensorboard/resnet18_gn_cifar10_noniid100 > ablation_main/resnet18_gn_cifar10_noniid100.txt

# #COMMUNICATION FREQ
# #local step = 20, 100, 500, 2500

# #cifar (step == 100 is run above)

# #** delay
# python3 main_fl_clean.py --dataset cifar10 -a resnet18 --print-freq 100 --steps 20 -b 20 --frac 0.5 --method step --alpha 0 --rounds 3200 --freeze_bn_at_round 1600 --num_classes 10 --num_data 49000 --lr 0.02 --num_users 10 --norm_layer BatchNorm --probe_activs --id ablation_main/tensorboard/resnet18_bn_cifar10_delay_freq20 > ablation_main/resnet18_bn_cifar10_delay_freq20.txt
# python3 main_fl_clean.py --dataset cifar10 -a resnet18 --print-freq 100 --steps 500 -b 20 --frac 0.5 --method step --alpha 0 --rounds 128 --freeze_bn_at_round 64 --num_classes 10 --num_data 49000 --lr 0.02 --num_users 10 --norm_layer BatchNorm --probe_activs --id ablation_main/tensorboard/resnet18_bn_cifar10_delay_freq500 > ablation_main/resnet18_bn_cifar10_delay_freq500.txt
# python3 main_fl_clean.py --dataset cifar10 -a resnet18 --print-freq 100 --steps 2500 -b 20 --frac 0.5 --method step --alpha 0 --rounds 128 --freeze_bn_at_round 13 --num_classes 10 --num_data 49000 --lr 0.02 --num_users 10 --norm_layer BatchNorm --probe_activs --id ablation_main/tensorboard/resnet18_bn_cifar10_delay_freq2500 > ablation_main/resnet18_bn_cifar10_delay_freq2500.txt

# #** regular BN
# python3 main_fl_clean.py --dataset cifar10 -a resnet18 --print-freq 100 --steps 20 -b 20 --frac 0.5 --method step --alpha 0 --rounds 3200 --num_classes 10 --num_data 49000 --lr 0.02 --num_users 10 --norm_layer BatchNorm --probe_activs --id ablation_main/tensorboard/resnet18_bn_cifar10_freq20 > ablation_main/resnet18_bn_cifar10_freq20.txt
# python3 main_fl_clean.py --dataset cifar10 -a resnet18 --print-freq 100 --steps 500 -b 20 --frac 0.5 --method step --alpha 0 --rounds 128 --num_classes 10 --num_data 49000 --lr 0.02 --num_users 10 --norm_layer BatchNorm --probe_activs --id ablation_main/tensorboard/resnet18_bn_cifar10_freq500 > ablation_main/resnet18_bn_cifar10_freq500.txt
# python3 main_fl_clean.py --dataset cifar10 -a resnet18 --print-freq 100 --steps 2500 -b 20 --frac 0.5 --method step --alpha 0 --rounds 128 --num_classes 10 --num_data 49000 --lr 0.02 --num_users 10 --norm_layer BatchNorm --probe_activs --id ablation_main/tensorboard/resnet18_bn_cifar10_freq2500 > ablation_main/resnet18_bn_cifar10_freq2500.txt


# #** regular GN
# python3 main_fl_clean.py --dataset cifar10 -a resnet18 --print-freq 100 --steps 20 -b 20 --frac 0.5 --method step --alpha 0 --rounds 3200 --num_classes 10 --num_data 49000 --lr 0.02 --num_users 10 --norm_layer GroupNorm --probe_activs --id ablation_main/tensorboard/resnet18_gn_cifar10_freq20 > ablation_main/resnet18_gn_cifar10_freq20.txt
# python3 main_fl_clean.py --dataset cifar10 -a resnet18 --print-freq 100 --steps 500 -b 20 --frac 0.5 --method step --alpha 0 --rounds 128 --num_classes 10 --num_data 49000 --lr 0.02 --num_users 10 --norm_layer GroupNorm --probe_activs --id ablation_main/tensorboard/resnet18_gn_cifar10_freq500 > ablation_main/resnet18_gn_cifar10_freq500.txt
# python3 main_fl_clean.py --dataset cifar10 -a resnet18 --print-freq 100 --steps 2500 -b 20 --frac 0.5 --method step --alpha 0 --rounds 128 --num_classes 10 --num_data 49000 --lr 0.02 --num_users 10 --norm_layer GroupNorm --probe_activs --id ablation_main/tensorboard/resnet18_gn_cifar10_freq2500 > ablation_main/resnet18_gn_cifar10_freq2500.txt


# #BATCH SIZE
# #BS = 2, 20, 100 (20 is already included in main run)

# #tiny 
# #** delay
# python3 main_fl_clean.py --dataset tiny --data /fs/scratch/PAS2099/pfl_final/data_/data/tiny-imagenet-200 -a resnet18 --print-freq 100 --steps 100 -b 2 --frac 0.5 --method step --alpha 0.1 --rounds 1255 --num_data 98000 --lr 0.002 --num_users 10 --norm_layer BatchNorm --freeze_bn_at_round 627 --probe_activs --id ablation_main/tensorboard/resnet18_bn_tiny_delay_bs2 > ablation_main/resnet18_bn_tiny_delay_bs2.txt
# python3 main_fl_clean.py --dataset tiny --data /fs/scratch/PAS2099/pfl_final/data_/data/tiny-imagenet-200 -a resnet18 --print-freq 100 --steps 100 -b 100 --frac 0.5 --method step --alpha 0.1 --rounds 1255 --num_data 98000 --lr 0.1 --num_users 10 --norm_layer BatchNorm --freeze_bn_at_round 627 --probe_activs --id ablation_main/tensorboard/resnet18_bn_tiny_delay_bs100 > ablation_main/resnet18_bn_tiny_delay_bs100.txt

# #** regular BN
# python3 main_fl_clean.py --dataset tiny --data /fs/scratch/PAS2099/pfl_final/data_/data/tiny-imagenet-200 -a resnet18 --print-freq 100 --steps 100 -b 2 --frac 0.5 --method step --alpha 0.1 --rounds 1255 --num_data 98000 --lr 0.002 --num_users 10 --norm_layer BatchNorm --id ablation_main/tensorboard/resnet18_bn_tiny_bs2 > ablation_main/resnet18_bn_tiny_bs2.txt
# python3 main_fl_clean.py --dataset tiny --data /fs/scratch/PAS2099/pfl_final/data_/data/tiny-imagenet-200 -a resnet18 --print-freq 100 --steps 100 -b 100 --frac 0.5 --method step --alpha 0.1 --rounds 1255 --num_data 98000 --lr 0.1 --num_users 10 --norm_layer BatchNorm --id ablation_main/tensorboard/resnet18_bn_tiny_bs100 > ablation_main/resnet18_bn_tiny_bs100.txt

# #** regular GN
# python3 main_fl_clean.py --dataset tiny --data /fs/scratch/PAS2099/pfl_final/data_/data/tiny-imagenet-200 -a resnet18 --print-freq 100 --steps 100 -b 2 --frac 0.5 --method step --alpha 0.1 --rounds 1255 --num_data 98000 --lr 0.002 --num_users 10 --norm_layer GroupNorm --id ablation_main/tensorboard/resnet18_gn_tiny_bs2 > ablation_main/resnet18_gn_tiny_bs2.txt
# python3 main_fl_clean.py --dataset tiny --data /fs/scratch/PAS2099/pfl_final/data_/data/tiny-imagenet-200 -a resnet18 --print-freq 100 --steps 100 -b 100 --frac 0.5 --method step --alpha 0.1 --rounds 1255 --num_data 98000 --lr 0.1 --num_users 10 --norm_layer GroupNorm --id ablation_main/tensorboard/resnet18_gn_tiny_bs100 > ablation_main/resnet18_gn_tiny_bs100.txt

# #cifar 
# #** delay
# python3 main_fl_clean.py --dataset cifar10 -a resnet18 --print-freq 100 --steps 100 -b 2 --frac 0.5 --method step --alpha 0 --rounds 640 --freeze_bn_at_round 320 --num_classes 10 --num_data 49000 --lr 0.002 --num_users 10 --norm_layer BatchNorm --probe_activs --id ablation_main/tensorboard/resnet18_bn_cifar10_delay_bs2 > ablation_main/resnet18_bn_cifar10_delay_bs2.txt
# python3 main_fl_clean.py --dataset cifar10 -a resnet18 --print-freq 100 --steps 100 -b 100 --frac 0.5 --method step --alpha 0 --rounds 640 --freeze_bn_at_round 320 --num_classes 10 --num_data 49000 --lr 0.1 --num_users 10 --norm_layer BatchNorm --probe_activs --id ablation_main/tensorboard/resnet18_bn_cifar10_delay_bs100 > ablation_main/resnet18_bn_cifar10_delay_bs100.txt

# #** regular BN
# python3 main_fl_clean.py --dataset cifar10 -a resnet18 --print-freq 100 --steps 100 -b 2 --frac 0.5 --method step --alpha 0 --rounds 640 --num_classes 10 --num_data 49000 --lr 0.002 --num_users 10 --norm_layer BatchNorm --probe_activs --id ablation_main/tensorboard/resnet18_bn_cifar10_bs2 > ablation_main/resnet18_bn_cifar10_bs2.txt
# python3 main_fl_clean.py --dataset cifar10 -a resnet18 --print-freq 100 --steps 100 -b 100 --frac 0.5 --method step --alpha 0 --rounds 640 --num_classes 10 --num_data 49000 --lr 0.1 --num_users 10 --norm_layer BatchNorm --probe_activs --id ablation_main/tensorboard/resnet18_bn_cifar10_bs100 > ablation_main/resnet18_bn_cifar10_bs100.txt

# #** regular GN
# python3 main_fl_clean.py --dataset cifar10 -a resnet18 --print-freq 100 --steps 100 -b 2 --frac 0.5 --method step --alpha 0 --rounds 640 --num_classes 10 --num_data 49000 --lr 0.002 --num_users 10 --norm_layer GroupNorm --probe_activs --id ablation_main/tensorboard/resnet18_gn_cifar10_bs2 > ablation_main/resnet18_gn_cifar10_bs2.txt
# python3 main_fl_clean.py --dataset cifar10 -a resnet18 --print-freq 100 --steps 100 -b 100 --frac 0.5 --method step --alpha 0 --rounds 640 --num_classes 10 --num_data 49000 --lr 0.1 --num_users 10 --norm_layer GroupNorm --probe_activs --id ablation_main/tensorboard/resnet18_gn_cifar10_bs100 > ablation_main/resnet18_gn_cifar10_bs100.txt


# #NUM USERS
# #num users = 2, 10, 100 (10 in included in main run)

# #tiny
# #**delay
# python3 main_fl_clean.py --dataset tiny --data /fs/scratch/PAS2099/pfl_final/data_/data/tiny-imagenet-200 -a resnet18 --print-freq 100 --steps 100 -b 20 --frac 0.5 --method step --alpha 0.1 --rounds 3136 --num_data 98000 --lr 0.02 --num_users 4 --norm_layer BatchNorm --freeze_bn_at_round 1568 --probe_activs --id ablation_main/tensorboard/resnet18_bn_tiny_delay_user4 > ablation_main/resnet18_bn_tiny_delay_user4.txt
# python3 main_fl_clean.py --dataset tiny --data /fs/scratch/PAS2099/pfl_final/data_/data/tiny-imagenet-200 -a resnet18 --print-freq 100 --steps 100 -b 20 --frac 0.5 --method step --alpha 0.1 --rounds 128 --num_data 98000 --lr 0.02 --num_users 100 --norm_layer BatchNorm --freeze_bn_at_round 64 --probe_activs --id ablation_main/tensorboard/resnet18_bn_tiny_delay_user100 > ablation_main/resnet18_bn_tiny_delay_user100.txt

# #** BN
# python3 main_fl_clean.py --dataset tiny --data /fs/scratch/PAS2099/pfl_final/data_/data/tiny-imagenet-200 -a resnet18 --print-freq 100 --steps 100 -b 20 --frac 0.5 --method step --alpha 0.1 --rounds 3136 --num_data 98000 --lr 0.02 --num_users 4 --norm_layer BatchNorm --id ablation_main/tensorboard/resnet18_bn_tiny_user4 > ablation_main/resnet18_bn_tiny_user4.txt
# python3 main_fl_clean.py --dataset tiny --data /fs/scratch/PAS2099/pfl_final/data_/data/tiny-imagenet-200 -a resnet18 --print-freq 100 --steps 100 -b 20 --frac 0.5 --method step --alpha 0.1 --rounds 128 --num_data 98000 --lr 0.02 --num_users 100 --norm_layer BatchNorm --id ablation_main/tensorboard/resnet18_bn_tiny_user100 > ablation_main/resnet18_bn_tiny_user100.txt

# #** GN
# python3 main_fl_clean.py --dataset tiny --data /fs/scratch/PAS2099/pfl_final/data_/data/tiny-imagenet-200 -a resnet18 --print-freq 100 --steps 100 -b 20 --frac 0.5 --method step --alpha 0.1 --rounds 3136 --num_data 98000 --lr 0.02 --num_users 4 --norm_layer GroupNorm --id ablation_main/tensorboard/resnet18_gn_tiny_user4 > ablation_main/resnet18_gn_tiny_user4.txt
# python3 main_fl_clean.py --dataset tiny --data /fs/scratch/PAS2099/pfl_final/data_/data/tiny-imagenet-200 -a resnet18 --print-freq 100 --steps 100 -b 20 --frac 0.5 --method step --alpha 0.1 --rounds 128 --num_data 98000 --lr 0.02 --num_users 100 --norm_layer GroupNorm --id ablation_main/tensorboard/resnet18_gn_tiny_user100 > ablation_main/resnet18_gn_tiny_user100.txt

# #cifar
# #**delay
# python3 main_fl_clean.py --dataset cifar10 -a resnet18 --print-freq 100 --steps 100 -b 20 --frac 0.5 --method step --alpha 0 --rounds 1600 --freeze_bn_at_round 800 --num_classes 10 --num_data 49000 --lr 0.02 --num_users 4 --norm_layer BatchNorm --probe_activs --id ablation_main/tensorboard/resnet18_bn_cifar10_delay_user4 > ablation_main/resnet18_bn_cifar10_delay_user4.txt
# python3 main_fl_clean.py --dataset cifar10 -a resnet18 --print-freq 100 --steps 100 -b 20 --frac 0.5 --method step --alpha 0 --rounds 128 --freeze_bn_at_round 32 --num_classes 10 --num_data 49000 --lr 0.02 --num_users 100 --norm_layer BatchNorm --probe_activs --id ablation_main/tensorboard/resnet18_bn_cifar10_delay_user100 > ablation_main/resnet18_bn_cifar10_delay_user100.txt

# #** BN
# python3 main_fl_clean.py --dataset cifar10 -a resnet18 --print-freq 100 --steps 100 -b 20 --frac 0.5 --method step --alpha 0 --rounds 1600 --num_classes 10 --num_data 49000 --lr 0.02 --num_users 4 --norm_layer BatchNorm --probe_activs --id ablation_main/tensorboard/resnet18_bn_cifar10_user4 > ablation_main/resnet18_bn_cifar10_user4.txt
# python3 main_fl_clean.py --dataset cifar10 -a resnet18 --print-freq 100 --steps 100 -b 20 --frac 0.5 --method step --alpha 0 --rounds 128 --num_classes 10 --num_data 49000 --lr 0.02 --num_users 100 --norm_layer BatchNorm --probe_activs --id ablation_main/tensorboard/resnet18_bn_cifar10_user100 > ablation_main/resnet18_bn_cifar10_user100.txt

# #** GN
# python3 main_fl_clean.py --dataset cifar10 -a resnet18 --print-freq 100 --steps 100 -b 20 --frac 0.5 --method step --alpha 0 --rounds 1600 --num_classes 10 --num_data 49000 --lr 0.02 --num_users 4 --norm_layer GroupNorm --probe_activs --id ablation_main/tensorboard/resnet18_gn_cifar10_user4 > ablation_main/resnet18_gn_cifar10_user4.txt
# python3 main_fl_clean.py --dataset cifar10 -a resnet18 --print-freq 100 --steps 100 -b 20 --frac 0.5 --method step --alpha 0 --rounds 128 --num_classes 10 --num_data 49000 --lr 0.02 --num_users 100 --norm_layer GroupNorm --probe_activs --id ablation_main/tensorboard/resnet18_gn_cifar10_user100 > ablation_main/resnet18_gn_cifar10_user100.txt


# #JOINT EFFECT NONIID LOCAL STEP DELAY ONLY

# #* delay

# #**shards (already run, skip)
# python3 main_fl_clean.py --dataset cifar10 -a resnet18 --print-freq 100 --steps 1 -b 20 --frac 0.5 --method step --alpha 0 --rounds 64000 --freeze_bn_at_round 32000 --num_classes 10 --num_data 49000 --lr 0.02 --num_users 10 --norm_layer BatchNorm --probe_activs --id ablation_main/tensorboard/resnet18_bn_cifar10_delayshardsstep1_special > ablation_main/resnet18_bn_cifar10_delayshardsstep1_special.txt
# python3 main_fl_clean.py --dataset cifar10 -a resnet18 --print-freq 100 --steps 20 -b 20 --frac 0.5 --method step --alpha 0 --rounds 3200 --freeze_bn_at_round 1600 --num_classes 10 --num_data 49000 --lr 0.02 --num_users 10 --norm_layer BatchNorm --probe_activs --update_bn_after_freeze --id ablation_main/tensorboard/resnet18_bn_cifar10_delay_freq20.updateBN > ablation_main/resnet18_bn_cifar10_delay_freq20.updateBN.txt
# python3 main_fl_clean.py --dataset cifar10 -a resnet18 --print-freq 100 --steps 100 -b 20 --frac 0.5 --method step --alpha 0 --rounds 640 --freeze_bn_at_round 320 --num_classes 10 --num_data 49000 --lr 0.02 --num_users 10 --norm_layer BatchNorm --probe_activs --update_bn_after_freeze --id ablation_main/tensorboard/resnet18_bn_cifar10_delay_freq100.updateBN > ablation_main/resnet18_bn_cifar10_delay_freq100.updateBN.txt
# python3 main_fl_clean.py --dataset cifar10 -a resnet18 --print-freq 100 --steps 500 -b 20 --frac 0.5 --method step --alpha 0 --rounds 128 --freeze_bn_at_round 64 --num_classes 10 --num_data 49000 --lr 0.02 --num_users 10 --norm_layer BatchNorm --probe_activs --update_bn_after_freeze --id ablation_main/tensorboard/resnet18_bn_cifar10_delay_freq500.updateBN > ablation_main/resnet18_bn_cifar10_delay_freq500.updateBN.txt
# python3 main_fl_clean.py --dataset cifar10 -a resnet18 --print-freq 100 --steps 2500 -b 20 --frac 0.5 --method step --alpha 0 --rounds 128 --freeze_bn_at_round 13 --num_classes 10 --num_data 49000 --lr 0.02 --num_users 10 --norm_layer BatchNorm --probe_activs --update_bn_after_freeze --id ablation_main/tensorboard/resnet18_bn_cifar10_delay_freq2500.updateBN > ablation_main/resnet18_bn_cifar10_delay_freq2500.updateBN.txt

# #*0.1
# python3 main_fl_clean.py --dataset cifar10 -a resnet18 --print-freq 100 --steps 20 -b 20 --frac 0.5 --method step --alpha 0.1 --rounds 3200 --freeze_bn_at_round 1600 --num_classes 10 --num_data 49000 --lr 0.02 --num_users 10 --norm_layer BatchNorm --probe_activs --id ablation_main/tensorboard/resnet18_bn_cifar10_delaya01step20 > ablation_main/resnet18_bn_cifar10_delaya01step20.txt
# python3 main_fl_clean.py --dataset cifar10 -a resnet18 --print-freq 100 --steps 500 -b 20 --frac 0.5 --method step --alpha 0.1 --rounds 128 --freeze_bn_at_round 64 --num_classes 10 --num_data 49000 --lr 0.02 --num_users 10 --norm_layer BatchNorm --probe_activs --id ablation_main/tensorboard/resnet18_bn_cifar10_delaya01step500 > ablation_main/resnet18_bn_cifar10_delaya01step500.txt
# python3 main_fl_clean.py --dataset cifar10 -a resnet18 --print-freq 100 --steps 2500 -b 20 --frac 0.5 --method step --alpha 0.1 --rounds 128 --freeze_bn_at_round 13 --num_classes 10 --num_data 49000 --lr 0.02 --num_users 10 --norm_layer BatchNorm --probe_activs --id ablation_main/tensorboard/resnet18_bn_cifar10_delaya01step2500 > ablation_main/resnet18_bn_cifar10_delaya01step2500.txt

# #0.3
# python3 main_fl_clean.py --dataset cifar10 -a resnet18 --print-freq 100 --steps 20 -b 20 --frac 0.5 --method step --alpha 0.3 --rounds 3200 --freeze_bn_at_round 1600 --num_classes 10 --num_data 49000 --lr 0.02 --num_users 10 --norm_layer BatchNorm --probe_activs --id ablation_main/tensorboard/resnet18_bn_cifar10_delaya03step20 > ablation_main/resnet18_bn_cifar10_delaya03step20.txt
# python3 main_fl_clean.py --dataset cifar10 -a resnet18 --print-freq 100 --steps 100 -b 20 --frac 0.5 --method step --alpha 0.3 --rounds 640 --freeze_bn_at_round 320 --num_classes 10 --num_data 49000 --lr 0.02 --num_users 10 --norm_layer BatchNorm --probe_activs --id ablation_main/tensorboard/resnet18_bn_cifar10_delaya03step100 > ablation_main/resnet18_bn_cifar10_delaya03step100.txt
# python3 main_fl_clean.py --dataset cifar10 -a resnet18 --print-freq 100 --steps 500 -b 20 --frac 0.5 --method step --alpha 0.3 --rounds 128 --freeze_bn_at_round 64 --num_classes 10 --num_data 49000 --lr 0.02 --num_users 10 --norm_layer BatchNorm --probe_activs --id ablation_main/tensorboard/resnet18_bn_cifar10_delaya03step500 > ablation_main/resnet18_bn_cifar10_delaya03step500.txt
# python3 main_fl_clean.py --dataset cifar10 -a resnet18 --print-freq 100 --steps 2500 -b 20 --frac 0.5 --method step --alpha 0.3 --rounds 128 --freeze_bn_at_round 13 --num_classes 10 --num_data 49000 --lr 0.02 --num_users 10 --norm_layer BatchNorm --probe_activs --id ablation_main/tensorboard/resnet18_bn_cifar10_delaya03step2500 > ablation_main/resnet18_bn_cifar10_delaya03step2500.txt

# #0.6
# python3 main_fl_clean.py --dataset cifar10 -a resnet18 --print-freq 100 --steps 20 -b 20 --frac 0.5 --method step --alpha 0.6 --rounds 3200 --freeze_bn_at_round 1600 --num_classes 10 --num_data 49000 --lr 0.02 --num_users 10 --norm_layer BatchNorm --probe_activs --id ablation_main/tensorboard/resnet18_bn_cifar10_delaya06step20 > ablation_main/resnet18_bn_cifar10_delaya06step20.txt
# python3 main_fl_clean.py --dataset cifar10 -a resnet18 --print-freq 100 --steps 500 -b 20 --frac 0.5 --method step --alpha 0.6 --rounds 128 --freeze_bn_at_round 64 --num_classes 10 --num_data 49000 --lr 0.02 --num_users 10 --norm_layer BatchNorm --probe_activs --id ablation_main/tensorboard/resnet18_bn_cifar10_delaya06step500 > ablation_main/resnet18_bn_cifar10_delaya06step500.txt
# python3 main_fl_clean.py --dataset cifar10 -a resnet18 --print-freq 100 --steps 2500 -b 20 --frac 0.5 --method step --alpha 0.6 --rounds 128 --freeze_bn_at_round 13 --num_classes 10 --num_data 49000 --lr 0.02 --num_users 10 --norm_layer BatchNorm --probe_activs --id ablation_main/tensorboard/resnet18_bn_cifar10_delaya06step2500 > ablation_main/resnet18_bn_cifar10_delaya06step2500.txt

# #100
# python3 main_fl_clean.py --dataset cifar10 -a resnet18 --print-freq 100 --steps 20 -b 20 --frac 0.5 --method step --alpha 100 --rounds 3200 --freeze_bn_at_round 1600 --num_classes 10 --num_data 49000 --lr 0.02 --num_users 10 --norm_layer BatchNorm --probe_activs --id ablation_main/tensorboard/resnet18_bn_cifar10_delaya100step20 > ablation_main/resnet18_bn_cifar10_delaya100step20.txt
# python3 main_fl_clean.py --dataset cifar10 -a resnet18 --print-freq 100 --steps 500 -b 20 --frac 0.5 --method step --alpha 100 --rounds 128 --freeze_bn_at_round 64 --num_classes 10 --num_data 49000 --lr 0.02 --num_users 10 --norm_layer BatchNorm --probe_activs --id ablation_main/tensorboard/resnet18_bn_cifar10_delaya100step500 > ablation_main/resnet18_bn_cifar10_delaya100step500.txt
# python3 main_fl_clean.py --dataset cifar10 -a resnet18 --print-freq 100 --steps 2500 -b 20 --frac 0.5 --method step --alpha 100 --rounds 128 --freeze_bn_at_round 13 --num_classes 10 --num_data 49000 --lr 0.02 --num_users 10 --norm_layer BatchNorm --probe_activs --id ablation_main/tensorboard/resnet18_bn_cifar10_delaya100step2500 > ablation_main/resnet18_bn_cifar10_delaya100step2500.txt




# ##make up


# #** delay
# python3 main_fl_clean.py --dataset cifar10 -a resnet18 --print-freq 100 --steps 20 -b 20 --frac 0.5 --method dir --alpha 0.1 --rounds 3200 --freeze_bn_at_round 1600 --num_classes 10 --num_data 49000 --lr 0.02 --num_users 10 --norm_layer BatchNorm --probe_activs --id ablation_main/tensorboard/resnet18_bn_cifar10_delay_freq20_a01 > ablation_main/resnet18_bn_cifar10_delay_freq20_a01.txt
# python3 main_fl_clean.py --dataset cifar10 -a resnet18 --print-freq 100 --steps 500 -b 20 --frac 0.5 --method dir --alpha 0.1 --rounds 128 --freeze_bn_at_round 64 --num_classes 10 --num_data 49000 --lr 0.02 --num_users 10 --norm_layer BatchNorm --probe_activs --id ablation_main/tensorboard/resnet18_bn_cifar10_delay_freq500_a01 > ablation_main/resnet18_bn_cifar10_delay_freq500_a01.txt
# python3 main_fl_clean.py --dataset cifar10 -a resnet18 --print-freq 100 --steps 2500 -b 20 --frac 0.5 --method dir --alpha 0.1 --rounds 128 --freeze_bn_at_round 13 --num_classes 10 --num_data 49000 --lr 0.02 --num_users 10 --norm_layer BatchNorm --probe_activs --id ablation_main/tensorboard/resnet18_bn_cifar10_delay_freq2500_a01 > ablation_main/resnet18_bn_cifar10_delay_freq2500_a01.txt

# #** regular BN
# python3 main_fl_clean.py --dataset cifar10 -a resnet18 --print-freq 100 --steps 20 -b 20 --frac 0.5 --method dir --alpha 0.1 --rounds 3200 --num_classes 10 --num_data 49000 --lr 0.02 --num_users 10 --norm_layer BatchNorm --probe_activs --id ablation_main/tensorboard/resnet18_bn_cifar10_freq20_a01 > ablation_main/resnet18_bn_cifar10_freq20_a01.txt
# python3 main_fl_clean.py --dataset cifar10 -a resnet18 --print-freq 100 --steps 500 -b 20 --frac 0.5 --method dir --alpha 0.1 --rounds 128 --num_classes 10 --num_data 49000 --lr 0.02 --num_users 10 --norm_layer BatchNorm --probe_activs --id ablation_main/tensorboard/resnet18_bn_cifar10_freq500_a01 > ablation_main/resnet18_bn_cifar10_freq500_a01.txt
# python3 main_fl_clean.py --dataset cifar10 -a resnet18 --print-freq 100 --steps 2500 -b 20 --frac 0.5 --method dir --alpha 0.1 --rounds 128 --num_classes 10 --num_data 49000 --lr 0.02 --num_users 10 --norm_layer BatchNorm --probe_activs --id ablation_main/tensorboard/resnet18_bn_cifar10_freq2500_a01 > ablation_main/resnet18_bn_cifar10_freq2500_a01.txt


# #** regular GN
# python3 main_fl_clean.py --dataset cifar10 -a resnet18 --print-freq 100 --steps 20 -b 20 --frac 0.5 --method dir --alpha 0.1 --rounds 3200 --num_classes 10 --num_data 49000 --lr 0.02 --num_users 10 --norm_layer GroupNorm --probe_activs --id ablation_main/tensorboard/resnet18_gn_cifar10_freq20_a01 > ablation_main/resnet18_gn_cifar10_freq20_a01.txt
# python3 main_fl_clean.py --dataset cifar10 -a resnet18 --print-freq 100 --steps 500 -b 20 --frac 0.5 --method dir --alpha 0.1 --rounds 128 --num_classes 10 --num_data 49000 --lr 0.02 --num_users 10 --norm_layer GroupNorm --probe_activs --id ablation_main/tensorboard/resnet18_gn_cifar10_freq500_a01 > ablation_main/resnet18_gn_cifar10_freq500_a01.txt
# python3 main_fl_clean.py --dataset cifar10 -a resnet18 --print-freq 100 --steps 2500 -b 20 --frac 0.5 --method dir --alpha 0.1 --rounds 128 --num_classes 10 --num_data 49000 --lr 0.02 --num_users 10 --norm_layer GroupNorm --probe_activs --id ablation_main/tensorboard/resnet18_gn_cifar10_freq2500_a01 > ablation_main/resnet18_gn_cifar10_freq2500_a01.txt

# #** delay
# python3 main_fl_clean.py --dataset cifar10 -a resnet18 --print-freq 100 --steps 20 -b 20 --frac 0.5 --method dir --alpha 0.6 --rounds 3200 --freeze_bn_at_round 1600 --num_classes 10 --num_data 49000 --lr 0.02 --num_users 10 --norm_layer BatchNorm --probe_activs --id ablation_main/tensorboard/resnet18_bn_cifar10_delay_freq20_a06 > ablation_main/resnet18_bn_cifar10_delay_freq20_a06.txt
# python3 main_fl_clean.py --dataset cifar10 -a resnet18 --print-freq 100 --steps 500 -b 20 --frac 0.5 --method dir --alpha 0.6 --rounds 128 --freeze_bn_at_round 64 --num_classes 10 --num_data 49000 --lr 0.02 --num_users 10 --norm_layer BatchNorm --probe_activs --id ablation_main/tensorboard/resnet18_bn_cifar10_delay_freq500_a06 > ablation_main/resnet18_bn_cifar10_delay_freq500_a06.txt
# python3 main_fl_clean.py --dataset cifar10 -a resnet18 --print-freq 100 --steps 2500 -b 20 --frac 0.5 --method dir --alpha 0.6 --rounds 128 --freeze_bn_at_round 13 --num_classes 10 --num_data 49000 --lr 0.02 --num_users 10 --norm_layer BatchNorm --probe_activs --id ablation_main/tensorboard/resnet18_bn_cifar10_delay_freq2500_a06 > ablation_main/resnet18_bn_cifar10_delay_freq2500_a06.txt

# #** regular BN
# python3 main_fl_clean.py --dataset cifar10 -a resnet18 --print-freq 100 --steps 20 -b 20 --frac 0.5 --method dir --alpha 0.6 --rounds 3200 --num_classes 10 --num_data 49000 --lr 0.02 --num_users 10 --norm_layer BatchNorm --probe_activs --id ablation_main/tensorboard/resnet18_bn_cifar10_freq20_a06 > ablation_main/resnet18_bn_cifar10_freq20_a06.txt
# python3 main_fl_clean.py --dataset cifar10 -a resnet18 --print-freq 100 --steps 500 -b 20 --frac 0.5 --method dir --alpha 0.6 --rounds 128 --num_classes 10 --num_data 49000 --lr 0.02 --num_users 10 --norm_layer BatchNorm --probe_activs --id ablation_main/tensorboard/resnet18_bn_cifar10_freq500_a06 > ablation_main/resnet18_bn_cifar10_freq500_a06.txt
# python3 main_fl_clean.py --dataset cifar10 -a resnet18 --print-freq 100 --steps 2500 -b 20 --frac 0.5 --method dir --alpha 0.6 --rounds 128 --num_classes 10 --num_data 49000 --lr 0.02 --num_users 10 --norm_layer BatchNorm --probe_activs --id ablation_main/tensorboard/resnet18_bn_cifar10_freq2500_a06 > ablation_main/resnet18_bn_cifar10_freq2500_a06.txt


# #** regular GN
# python3 main_fl_clean.py --dataset cifar10 -a resnet18 --print-freq 100 --steps 20 -b 20 --frac 0.5 --method dir --alpha 0.6 --rounds 3200 --num_classes 10 --num_data 49000 --lr 0.02 --num_users 10 --norm_layer GroupNorm --probe_activs --id ablation_main/tensorboard/resnet18_gn_cifar10_freq20_a06 > ablation_main/resnet18_gn_cifar10_freq20_a06.txt
# python3 main_fl_clean.py --dataset cifar10 -a resnet18 --print-freq 100 --steps 500 -b 20 --frac 0.5 --method dir --alpha 0.6 --rounds 128 --num_classes 10 --num_data 49000 --lr 0.02 --num_users 10 --norm_layer GroupNorm --probe_activs --id ablation_main/tensorboard/resnet18_gn_cifar10_freq500_a06 > ablation_main/resnet18_gn_cifar10_freq500_a06.txt
# python3 main_fl_clean.py --dataset cifar10 -a resnet18 --print-freq 100 --steps 2500 -b 20 --frac 0.5 --method dir --alpha 0.6 --rounds 128 --num_classes 10 --num_data 49000 --lr 0.02 --num_users 10 --norm_layer GroupNorm --probe_activs --id ablation_main/tensorboard/resnet18_gn_cifar10_freq2500_a06 > ablation_main/resnet18_gn_cifar10_freq2500_a06.txt

# #** delay
# python3 main_fl_clean.py --dataset cifar10 -a resnet18 --print-freq 100 --steps 20 -b 20 --frac 0.5 --method dir --alpha 100 --rounds 3200 --freeze_bn_at_round 1600 --num_classes 10 --num_data 49000 --lr 0.02 --num_users 10 --norm_layer BatchNorm --probe_activs --id ablation_main/tensorboard/resnet18_bn_cifar10_delay_freq20_a100 > ablation_main/resnet18_bn_cifar10_delay_freq20_a100.txt
# python3 main_fl_clean.py --dataset cifar10 -a resnet18 --print-freq 100 --steps 500 -b 20 --frac 0.5 --method dir --alpha 100 --rounds 128 --freeze_bn_at_round 64 --num_classes 10 --num_data 49000 --lr 0.02 --num_users 10 --norm_layer BatchNorm --probe_activs --id ablation_main/tensorboard/resnet18_bn_cifar10_delay_freq500_a100 > ablation_main/resnet18_bn_cifar10_delay_freq500_a100.txt
# python3 main_fl_clean.py --dataset cifar10 -a resnet18 --print-freq 100 --steps 2500 -b 20 --frac 0.5 --method dir --alpha 100 --rounds 128 --freeze_bn_at_round 13 --num_classes 10 --num_data 49000 --lr 0.02 --num_users 10 --norm_layer BatchNorm --probe_activs --id ablation_main/tensorboard/resnet18_bn_cifar10_delay_freq2500_a100 > ablation_main/resnet18_bn_cifar10_delay_freq2500_a100.txt

# #** regular BN
# python3 main_fl_clean.py --dataset cifar10 -a resnet18 --print-freq 100 --steps 20 -b 20 --frac 0.5 --method dir --alpha 100 --rounds 3200 --num_classes 10 --num_data 49000 --lr 0.02 --num_users 10 --norm_layer BatchNorm --probe_activs --id ablation_main/tensorboard/resnet18_bn_cifar10_freq20_a100 > ablation_main/resnet18_bn_cifar10_freq20_a100.txt
# python3 main_fl_clean.py --dataset cifar10 -a resnet18 --print-freq 100 --steps 500 -b 20 --frac 0.5 --method dir --alpha 100 --rounds 128 --num_classes 10 --num_data 49000 --lr 0.02 --num_users 10 --norm_layer BatchNorm --probe_activs --id ablation_main/tensorboard/resnet18_bn_cifar10_freq500_a100 > ablation_main/resnet18_bn_cifar10_freq500_a100.txt
# python3 main_fl_clean.py --dataset cifar10 -a resnet18 --print-freq 100 --steps 2500 -b 20 --frac 0.5 --method dir --alpha 100 --rounds 128 --num_classes 10 --num_data 49000 --lr 0.02 --num_users 10 --norm_layer BatchNorm --probe_activs --id ablation_main/tensorboard/resnet18_bn_cifar10_freq2500_a100 > ablation_main/resnet18_bn_cifar10_freq2500_a100.txt


# #** regular GN
# python3 main_fl_clean.py --dataset cifar10 -a resnet18 --print-freq 100 --steps 20 -b 20 --frac 0.5 --method dir --alpha 100 --rounds 3200 --num_classes 10 --num_data 49000 --lr 0.02 --num_users 10 --norm_layer GroupNorm --probe_activs --id ablation_main/tensorboard/resnet18_gn_cifar10_freq20_a100 > ablation_main/resnet18_gn_cifar10_freq20_a100.txt
# python3 main_fl_clean.py --dataset cifar10 -a resnet18 --print-freq 100 --steps 500 -b 20 --frac 0.5 --method dir --alpha 100 --rounds 128 --num_classes 10 --num_data 49000 --lr 0.02 --num_users 10 --norm_layer GroupNorm --probe_activs --id ablation_main/tensorboard/resnet18_gn_cifar10_freq500_a100 > ablation_main/resnet18_gn_cifar10_freq500_a100.txt
# python3 main_fl_clean.py --dataset cifar10 -a resnet18 --print-freq 100 --steps 2500 -b 20 --frac 0.5 --method dir --alpha 100 --rounds 128 --num_classes 10 --num_data 49000 --lr 0.02 --num_users 10 --norm_layer GroupNorm --probe_activs --id ablation_main/tensorboard/resnet18_gn_cifar10_freq2500_a100 > ablation_main/resnet18_gn_cifar10_freq2500_a100.txt




# ## we study BN updated even after freeze
# python3 main_fl_clean.py --dataset cifar10 -a resnet18 --print-freq 100 --steps 20 -b 20 --frac 0.5 --method step --alpha 0 --rounds 3200 --freeze_bn_at_round 1600 --num_classes 10 --num_data 49000 --lr 0.02 --num_users 10 --norm_layer BatchNorm --probe_activs --update_bn_after_freeze --id ablation_main/tensorboard/resnet18_bn_cifar10_delay@half_freq20.updateBN > ablation_main/resnet18_bn_cifar10_delay@half_freq20.updateBN.txt
# python3 main_fl_clean.py --dataset cifar10 -a resnet18 --print-freq 100 --steps 100 -b 20 --frac 0.5 --method step --alpha 0 --rounds 640 --freeze_bn_at_round 320 --num_classes 10 --num_data 49000 --lr 0.02 --num_users 10 --norm_layer BatchNorm --probe_activs --update_bn_after_freeze --id ablation_main/tensorboard/resnet18_bn_cifar10_delay@half_freq100.updateBN > ablation_main/resnet18_bn_cifar10_delay@half_freq100.updateBN.txt
# python3 main_fl_clean.py --dataset cifar10 -a resnet18 --print-freq 100 --steps 500 -b 20 --frac 0.5 --method step --alpha 0 --rounds 128 --freeze_bn_at_round 64 --num_classes 10 --num_data 49000 --lr 0.02 --num_users 10 --norm_layer BatchNorm --probe_activs --update_bn_after_freeze --id ablation_main/tensorboard/resnet18_bn_cifar10_delay@half_freq500.updateBN > ablation_main/resnet18_bn_cifar10_delay@half_freq500.updateBN.txt
# python3 main_fl_clean.py --dataset cifar10 -a resnet18 --print-freq 100 --steps 2500 -b 20 --frac 0.5 --method step --alpha 0 --rounds 128 --freeze_bn_at_round 13 --num_classes 10 --num_data 49000 --lr 0.02 --num_users 10 --norm_layer BatchNorm --probe_activs --update_bn_after_freeze --id ablation_main/tensorboard/resnet18_bn_cifar10_delay@half_freq2500.updateBN > ablation_main/resnet18_bn_cifar10_delay@half_freq2500.updateBN.txt

# python3 main_fl_clean.py --dataset tiny --data /fs/scratch/PAS2099/pfl_final/data_/data/tiny-imagenet-200 -a resnet18 --print-freq 100 --steps 20 -b 20 --frac 0.5 --method step --alpha 0.1 --rounds 6400 --num_data 98000 --lr 0.02 --num_users 10 --norm_layer BatchNorm --freeze_bn_at_round 3200 --probe_activs --update_bn_after_freeze --id tiny_output/tensorboard/resnet18_bn_step20_delay@half.updateBN > tiny_output/resnet18_bn_step20_delay@half.updateBN.txt
# python3 main_fl_clean.py --dataset tiny --data /fs/scratch/PAS2099/pfl_final/data_/data/tiny-imagenet-200 -a resnet18 --print-freq 100 --steps 100 -b 20 --frac 0.5 --method step --alpha 0.1 --rounds 1255 --num_data 98000 --lr 0.02 --num_users 10 --norm_layer BatchNorm --freeze_bn_at_round 627 --probe_activs --update_bn_after_freeze --id tiny_output/tensorboard/resnet18_bn_step100_delay@half.updateBN > tiny_output/resnet18_bn_step100_delay@half.updateBN.txt
# python3 main_fl_clean.py --dataset tiny --data /fs/scratch/PAS2099/pfl_final/data_/data/tiny-imagenet-200 -a resnet18 --print-freq 100 --steps 500 -b 20 --frac 0.5 --method step --alpha 0.1 --rounds 251 --num_data 98000 --lr 0.02 --num_users 10 --norm_layer BatchNorm --freeze_bn_at_round 126 --probe_activs --update_bn_after_freeze --id tiny_output/tensorboard/resnet18_bn_step500_delay@half.updateBN > tiny_output/resnet18_bn_step500_delay@half.updateBN.txt
# python3 main_fl_clean.py --dataset tiny --data /fs/scratch/PAS2099/pfl_final/data_/data/tiny-imagenet-200 -a resnet18 --print-freq 100 --steps 2500 -b 20 --frac 0.5 --method step --alpha 0.1 --rounds 128 --num_data 98000 --lr 0.02 --num_users 10 --norm_layer BatchNorm --freeze_bn_at_round 64 --probe_activs --update_bn_after_freeze --id tiny_output/tensorboard/resnet18_bn_step2500_delay@half.updateBN > tiny_output/resnet18_bn_step2500_delay@half.updateBN.txt


# ##We test freezing BN at different stage for tiny
# python3 main_fl_clean.py --dataset tiny --data /fs/scratch/PAS2099/pfl_final/data_/data/tiny-imagenet-200 -a resnet18 --print-freq 100 --steps 100 -b 20 --frac 0.5 --method dir --alpha 0.1 --rounds 1500 --num_data 98000 --lr 0.02 --num_users 10 --norm_layer BatchNorm --freeze_bn_at_round 200 --probe_activs --id tiny_output/tensorboard/resnet18_bn_step100_delay@200_a01.tune_tiny > tiny_output/resnet18_bn_step100_delay@200_a01.tune_tiny.txt
# python3 main_fl_clean.py --dataset tiny --data /fs/scratch/PAS2099/pfl_final/data_/data/tiny-imagenet-200 -a resnet18 --print-freq 100 --steps 100 -b 20 --frac 0.5 --method dir --alpha 0.1 --rounds 1500 --num_data 98000 --lr 0.02 --num_users 10 --norm_layer BatchNorm --freeze_bn_at_round 400 --probe_activs --id tiny_output/tensorboard/resnet18_bn_step100_delay@400_a01.tune_tiny > tiny_output/resnet18_bn_step100_delay@400_a01.tune_tiny.txt
# python3 main_fl_clean.py --dataset tiny --data /fs/scratch/PAS2099/pfl_final/data_/data/tiny-imagenet-200 -a resnet18 --print-freq 100 --steps 100 -b 20 --frac 0.5 --method dir --alpha 0.1 --rounds 1500 --num_data 98000 --lr 0.02 --num_users 10 --norm_layer BatchNorm --freeze_bn_at_round 600 --probe_activs --id tiny_output/tensorboard/resnet18_bn_step100_delay@600_a01.tune_tiny > tiny_output/resnet18_bn_step100_delay@600_a01.tune_tiny.txt
# python3 main_fl_clean.py --dataset tiny --data /fs/scratch/PAS2099/pfl_final/data_/data/tiny-imagenet-200 -a resnet18 --print-freq 100 --steps 100 -b 20 --frac 0.5 --method dir --alpha 0.1 --rounds 1500 --num_data 98000 --lr 0.02 --num_users 10 --norm_layer BatchNorm --freeze_bn_at_round 800 --probe_activs --id tiny_output/tensorboard/resnet18_bn_step100_delay@800_a01.tune_tiny > tiny_output/resnet18_bn_step100_delay@800_a01.tune_tiny.txt
# python3 main_fl_clean.py --dataset tiny --data /fs/scratch/PAS2099/pfl_final/data_/data/tiny-imagenet-200 -a resnet18 --print-freq 100 --steps 100 -b 20 --frac 0.5 --method dir --alpha 0.1 --rounds 1500 --num_data 98000 --lr 0.02 --num_users 10 --norm_layer BatchNorm --freeze_bn_at_round 1000 --probe_activs --id tiny_output/tensorboard/resnet18_bn_step100_delay@1000_a01.tune_tiny > tiny_output/resnet18_bn_step100_delay@1000_a01.tune_tiny.txt
# python3 main_fl_clean.py --dataset tiny --data /fs/scratch/PAS2099/pfl_final/data_/data/tiny-imagenet-200 -a resnet18 --print-freq 100 --steps 100 -b 20 --frac 0.5 --method dir --alpha 0.1 --rounds 1500 --num_data 98000 --lr 0.02 --num_users 10 --norm_layer BatchNorm --freeze_bn_at_round 1200 --probe_activs --id tiny_output/tensorboard/resnet18_bn_step100_delay@1200_a01.tune_tiny > tiny_output/resnet18_bn_step100_delay@1200_a01.tune_tiny.txt
# python3 main_fl_clean.py --dataset tiny --data /fs/scratch/PAS2099/pfl_final/data_/data/tiny-imagenet-200 -a resnet18 --print-freq 100 --steps 100 -b 20 --frac 0.5 --method dir --alpha 0.1 --rounds 1500 --num_data 98000 --lr 0.02 --num_users 10 --norm_layer BatchNorm --freeze_bn_at_round 1400 --probe_activs --id tiny_output/tensorboard/resnet18_bn_step100_delay@1400_a01.tune_tiny > tiny_output/resnet18_bn_step100_delay@1400_a01.tune_tiny.txt


# python3 main_fl_clean.py --dataset tiny --data /fs/scratch/PAS2099/pfl_final/data_/data/tiny-imagenet-200 -a resnet18 --print-freq 100 --steps 100 -b 20 --frac 0.5 --method dir --alpha 100 --rounds 1500 --num_data 98000 --lr 0.02 --num_users 10 --norm_layer BatchNorm --freeze_bn_at_round 200 --probe_activs --id tiny_output/tensorboard/resnet18_bn_step100_delay@200_a100.tune_tiny > tiny_output/resnet18_bn_step100_delay@200_a100.tune_tiny.txt
# python3 main_fl_clean.py --dataset tiny --data /fs/scratch/PAS2099/pfl_final/data_/data/tiny-imagenet-200 -a resnet18 --print-freq 100 --steps 100 -b 20 --frac 0.5 --method dir --alpha 100 --rounds 1500 --num_data 98000 --lr 0.02 --num_users 10 --norm_layer BatchNorm --freeze_bn_at_round 400 --probe_activs --id tiny_output/tensorboard/resnet18_bn_step100_delay@400_a100.tune_tiny > tiny_output/resnet18_bn_step100_delay@400_a100.tune_tiny.txt
# python3 main_fl_clean.py --dataset tiny --data /fs/scratch/PAS2099/pfl_final/data_/data/tiny-imagenet-200 -a resnet18 --print-freq 100 --steps 100 -b 20 --frac 0.5 --method dir --alpha 100 --rounds 1500 --num_data 98000 --lr 0.02 --num_users 10 --norm_layer BatchNorm --freeze_bn_at_round 600 --probe_activs --id tiny_output/tensorboard/resnet18_bn_step100_delay@600_a100.tune_tiny > tiny_output/resnet18_bn_step100_delay@600_a100.tune_tiny.txt
# python3 main_fl_clean.py --dataset tiny --data /fs/scratch/PAS2099/pfl_final/data_/data/tiny-imagenet-200 -a resnet18 --print-freq 100 --steps 100 -b 20 --frac 0.5 --method dir --alpha 100 --rounds 1500 --num_data 98000 --lr 0.02 --num_users 10 --norm_layer BatchNorm --freeze_bn_at_round 800 --probe_activs --id tiny_output/tensorboard/resnet18_bn_step100_delay@800_a100.tune_tiny > tiny_output/resnet18_bn_step100_delay@800_a100.tune_tiny.txt
# python3 main_fl_clean.py --dataset tiny --data /fs/scratch/PAS2099/pfl_final/data_/data/tiny-imagenet-200 -a resnet18 --print-freq 100 --steps 100 -b 20 --frac 0.5 --method dir --alpha 100 --rounds 1500 --num_data 98000 --lr 0.02 --num_users 10 --norm_layer BatchNorm --freeze_bn_at_round 1000 --probe_activs --id tiny_output/tensorboard/resnet18_bn_step100_delay@1000_a100.tune_tiny > tiny_output/resnet18_bn_step100_delay@1000_a100.tune_tiny.txt
# python3 main_fl_clean.py --dataset tiny --data /fs/scratch/PAS2099/pfl_final/data_/data/tiny-imagenet-200 -a resnet18 --print-freq 100 --steps 100 -b 20 --frac 0.5 --method dir --alpha 100 --rounds 1500 --num_data 98000 --lr 0.02 --num_users 10 --norm_layer BatchNorm --freeze_bn_at_round 1200 --probe_activs --id tiny_output/tensorboard/resnet18_bn_step100_delay@1200_a100.tune_tiny > tiny_output/resnet18_bn_step100_delay@1200_a100.tune_tiny.txt
# python3 main_fl_clean.py --dataset tiny --data /fs/scratch/PAS2099/pfl_final/data_/data/tiny-imagenet-200 -a resnet18 --print-freq 100 --steps 100 -b 20 --frac 0.5 --method dir --alpha 100 --rounds 1500 --num_data 98000 --lr 0.02 --num_users 10 --norm_layer BatchNorm --freeze_bn_at_round 1400 --probe_activs --id tiny_output/tensorboard/resnet18_bn_step100_delay@1400_a100.tune_tiny > tiny_output/resnet18_bn_step100_delay@1400_a100.tune_tiny.txt

# # check resnet 50 
# python3 main_fl_clean.py --dataset tiny --data /fs/scratch/PAS2099/pfl_final/data_/data/tiny-imagenet-200 -a resnet18 --print-freq 100 --steps 100 -b 20 --frac 0.5 --method dir --alpha 0.1 --rounds 1500 --num_data 98000 --lr 0.01 --num_users 10 --norm_layer BatchNorm --freeze_bn_at_round 0 --probe_activs --id tiny_output/tensorboard/resnet50_bn_step100_delay@0_a01.tune_tiny > tiny_output/resnet50_bn_step100_delay@0_a01.tune_tiny.txt
# python3 main_fl_clean.py --dataset tiny --data /fs/scratch/PAS2099/pfl_final/data_/data/tiny-imagenet-200 -a resnet18 --print-freq 100 --steps 100 -b 20 --frac 0.5 --method dir --alpha 0.1 --rounds 1500 --num_data 98000 --lr 0.01 --num_users 10 --norm_layer BatchNorm --freeze_bn_at_round 200 --probe_activs --id tiny_output/tensorboard/resnet50_bn_step100_delay@200_a01.tune_tiny > tiny_output/resnet50_bn_step100_delay@200_a01.tune_tiny.txt
# python3 main_fl_clean.py --dataset tiny --data /fs/scratch/PAS2099/pfl_final/data_/data/tiny-imagenet-200 -a resnet18 --print-freq 100 --steps 100 -b 20 --frac 0.5 --method dir --alpha 0.1 --rounds 1500 --num_data 98000 --lr 0.01 --num_users 10 --norm_layer BatchNorm --freeze_bn_at_round 400 --probe_activs --id tiny_output/tensorboard/resnet50_bn_step100_delay@400_a01.tune_tiny > tiny_output/resnet50_bn_step100_delay@400_a01.tune_tiny.txt
# python3 main_fl_clean.py --dataset tiny --data /fs/scratch/PAS2099/pfl_final/data_/data/tiny-imagenet-200 -a resnet18 --print-freq 100 --steps 100 -b 20 --frac 0.5 --method dir --alpha 0.1 --rounds 1500 --num_data 98000 --lr 0.01 --num_users 10 --norm_layer BatchNorm --freeze_bn_at_round 600 --probe_activs --id tiny_output/tensorboard/resnet50_bn_step100_delay@600_a01.tune_tiny > tiny_output/resnet50_bn_step100_delay@600_a01.tune_tiny.txt
# python3 main_fl_clean.py --dataset tiny --data /fs/scratch/PAS2099/pfl_final/data_/data/tiny-imagenet-200 -a resnet18 --print-freq 100 --steps 100 -b 20 --frac 0.5 --method dir --alpha 0.1 --rounds 1500 --num_data 98000 --lr 0.01 --num_users 10 --norm_layer BatchNorm --freeze_bn_at_round 800 --probe_activs --id tiny_output/tensorboard/resnet50_bn_step100_delay@800_a01.tune_tiny > tiny_output/resnet50_bn_step100_delay@800_a01.tune_tiny.txt
# python3 main_fl_clean.py --dataset tiny --data /fs/scratch/PAS2099/pfl_final/data_/data/tiny-imagenet-200 -a resnet18 --print-freq 100 --steps 100 -b 20 --frac 0.5 --method dir --alpha 0.1 --rounds 1500 --num_data 98000 --lr 0.01 --num_users 10 --norm_layer BatchNorm --freeze_bn_at_round 1000 --probe_activs --id tiny_output/tensorboard/resnet50_bn_step100_delay@1000_a01.tune_tiny > tiny_output/resnet50_bn_step100_delay@1000_a01.tune_tiny.txt
# python3 main_fl_clean.py --dataset tiny --data /fs/scratch/PAS2099/pfl_final/data_/data/tiny-imagenet-200 -a resnet18 --print-freq 100 --steps 100 -b 20 --frac 0.5 --method dir --alpha 0.1 --rounds 1500 --num_data 98000 --lr 0.01 --num_users 10 --norm_layer BatchNorm --freeze_bn_at_round 1200 --probe_activs --id tiny_output/tensorboard/resnet50_bn_step100_delay@1200_a01.tune_tiny > tiny_output/resnet50_bn_step100_delay@1200_a01.tune_tiny.txt
# python3 main_fl_clean.py --dataset tiny --data /fs/scratch/PAS2099/pfl_final/data_/data/tiny-imagenet-200 -a resnet18 --print-freq 100 --steps 100 -b 20 --frac 0.5 --method dir --alpha 0.1 --rounds 1500 --num_data 98000 --lr 0.01 --num_users 10 --norm_layer BatchNorm --freeze_bn_at_round 1400 --probe_activs --id tiny_output/tensorboard/resnet50_bn_step100_delay@1400_a01.tune_tiny > tiny_output/resnet50_bn_step100_delay@1400_a01.tune_tiny.txt

# #check 20/40 users
# python3 main_fl_clean.py --dataset tiny --data /fs/scratch/PAS2099/pfl_final/data_/data/tiny-imagenet-200 -a resnet18 --print-freq 100 --steps 100 -b 20 --frac 0.5 --method dir --alpha 0.1 --rounds 1500 --num_data 98000 --lr 0.02 --num_users 20 --norm_layer BatchNorm --freeze_bn_at_round 0 --probe_activs --id tiny_output/tensorboard/resnet18_bn_step100_delay@0_a01.20user.tune_tiny > tiny_output/resnet18_bn_step100_delay@0_a01.20user.tune_tiny.txt
# python3 main_fl_clean.py --dataset tiny --data /fs/scratch/PAS2099/pfl_final/data_/data/tiny-imagenet-200 -a resnet18 --print-freq 100 --steps 100 -b 20 --frac 0.5 --method dir --alpha 0.1 --rounds 1500 --num_data 98000 --lr 0.02 --num_users 20 --norm_layer BatchNorm --freeze_bn_at_round 200 --probe_activs --id tiny_output/tensorboard/resnet18_bn_step100_delay@200_a01.20user.tune_tiny > tiny_output/resnet18_bn_step100_delay@200_a01.20user.tune_tiny.txt
# python3 main_fl_clean.py --dataset tiny --data /fs/scratch/PAS2099/pfl_final/data_/data/tiny-imagenet-200 -a resnet18 --print-freq 100 --steps 100 -b 20 --frac 0.5 --method dir --alpha 0.1 --rounds 1500 --num_data 98000 --lr 0.02 --num_users 20 --norm_layer BatchNorm --freeze_bn_at_round 600 --probe_activs --id tiny_output/tensorboard/resnet18_bn_step100_delay@600_a01.20user.tune_tiny > tiny_output/resnet18_bn_step100_delay@600_a01.20user.tune_tiny.txt
# python3 main_fl_clean.py --dataset tiny --data /fs/scratch/PAS2099/pfl_final/data_/data/tiny-imagenet-200 -a resnet18 --print-freq 100 --steps 100 -b 20 --frac 0.5 --method dir --alpha 0.1 --rounds 1500 --num_data 98000 --lr 0.02 --num_users 20 --norm_layer BatchNorm --freeze_bn_at_round 800 --probe_activs --id tiny_output/tensorboard/resnet18_bn_step100_delay@800_a01.20user.tune_tiny > tiny_output/resnet18_bn_step100_delay@800_a01.20user.tune_tiny.txt
# python3 main_fl_clean.py --dataset tiny --data /fs/scratch/PAS2099/pfl_final/data_/data/tiny-imagenet-200 -a resnet18 --print-freq 100 --steps 100 -b 20 --frac 0.5 --method dir --alpha 0.1 --rounds 1500 --num_data 98000 --lr 0.02 --num_users 20 --norm_layer BatchNorm --freeze_bn_at_round 1000 --probe_activs --id tiny_output/tensorboard/resnet18_bn_step100_delay@1000_a01.20user.tune_tiny > tiny_output/resnet18_bn_step100_delay@1000_a01.20user.tune_tiny.txt
# python3 main_fl_clean.py --dataset tiny --data /fs/scratch/PAS2099/pfl_final/data_/data/tiny-imagenet-200 -a resnet18 --print-freq 100 --steps 100 -b 20 --frac 0.5 --method dir --alpha 0.1 --rounds 1500 --num_data 98000 --lr 0.02 --num_users 20 --norm_layer BatchNorm --freeze_bn_at_round 1400 --probe_activs --id tiny_output/tensorboard/resnet18_bn_step100_delay@1400_a01.20user.tune_tiny > tiny_output/resnet18_bn_step100_delay@1400_a01.20user.tune_tiny.txt

# python3 main_fl_clean.py --dataset tiny --data /fs/scratch/PAS2099/pfl_final/data_/data/tiny-imagenet-200 -a resnet18 --print-freq 100 --steps 100 -b 20 --frac 0.5 --method dir --alpha 0.1 --rounds 1500 --num_data 98000 --lr 0.02 --num_users 40 --norm_layer BatchNorm --freeze_bn_at_round 0 --probe_activs --id tiny_output/tensorboard/resnet18_bn_step100_delay@0_a01.40user.tune_tiny > tiny_output/resnet18_bn_step100_delay@0_a01.40user.tune_tiny.txt
# python3 main_fl_clean.py --dataset tiny --data /fs/scratch/PAS2099/pfl_final/data_/data/tiny-imagenet-200 -a resnet18 --print-freq 100 --steps 100 -b 20 --frac 0.5 --method dir --alpha 0.1 --rounds 1500 --num_data 98000 --lr 0.02 --num_users 40 --norm_layer BatchNorm --freeze_bn_at_round 200 --probe_activs --id tiny_output/tensorboard/resnet18_bn_step100_delay@200_a01.40user.tune_tiny > tiny_output/resnet18_bn_step100_delay@200_a01.40user.tune_tiny.txt
# python3 main_fl_clean.py --dataset tiny --data /fs/scratch/PAS2099/pfl_final/data_/data/tiny-imagenet-200 -a resnet18 --print-freq 100 --steps 100 -b 20 --frac 0.5 --method dir --alpha 0.1 --rounds 1500 --num_data 98000 --lr 0.02 --num_users 40 --norm_layer BatchNorm --freeze_bn_at_round 600 --probe_activs --id tiny_output/tensorboard/resnet18_bn_step100_delay@600_a01.40user.tune_tiny > tiny_output/resnet18_bn_step100_delay@600_a01.40user.tune_tiny.txt
# python3 main_fl_clean.py --dataset tiny --data /fs/scratch/PAS2099/pfl_final/data_/data/tiny-imagenet-200 -a resnet18 --print-freq 100 --steps 100 -b 20 --frac 0.5 --method dir --alpha 0.1 --rounds 1500 --num_data 98000 --lr 0.02 --num_users 40 --norm_layer BatchNorm --freeze_bn_at_round 800 --probe_activs --id tiny_output/tensorboard/resnet18_bn_step100_delay@800_a01.40user.tune_tiny > tiny_output/resnet18_bn_step100_delay@800_a01.40user.tune_tiny.txt
# python3 main_fl_clean.py --dataset tiny --data /fs/scratch/PAS2099/pfl_final/data_/data/tiny-imagenet-200 -a resnet18 --print-freq 100 --steps 100 -b 20 --frac 0.5 --method dir --alpha 0.1 --rounds 1500 --num_data 98000 --lr 0.02 --num_users 40 --norm_layer BatchNorm --freeze_bn_at_round 1000 --probe_activs --id tiny_output/tensorboard/resnet18_bn_step100_delay@1000_a01.40user.tune_tiny > tiny_output/resnet18_bn_step100_delay@1000_a01.40user.tune_tiny.txt
# python3 main_fl_clean.py --dataset tiny --data /fs/scratch/PAS2099/pfl_final/data_/data/tiny-imagenet-200 -a resnet18 --print-freq 100 --steps 100 -b 20 --frac 0.5 --method dir --alpha 0.1 --rounds 1500 --num_data 98000 --lr 0.02 --num_users 40 --norm_layer BatchNorm --freeze_bn_at_round 1400 --probe_activs --id tiny_output/tensorboard/resnet18_bn_step100_delay@1400_a01.40user.tune_tiny > tiny_output/resnet18_bn_step100_delay@1400_a01.40user.tune_tiny.txt

# python3 main_fl_clean.py --dataset tiny --data /fs/scratch/PAS2099/pfl_final/data_/data/tiny-imagenet-200 -a resnet18 --print-freq 100 --steps 500 -b 20 --frac 0.5 --method dir --alpha 0.1 --rounds 1500 --num_data 98000 --lr 0.02 --num_users 10 --norm_layer BatchNorm --freeze_bn_at_round 200 --probe_activs --id tiny_output/tensorboard/resnet18_bn_step500_delay@200_a01.tune_tiny > tiny_output/resnet18_bn_step500_delay@200_a01.tune_tiny.txt
# python3 main_fl_clean.py --dataset tiny --data /fs/scratch/PAS2099/pfl_final/data_/data/tiny-imagenet-200 -a resnet18 --print-freq 100 --steps 500 -b 20 --frac 0.5 --method dir --alpha 0.1 --rounds 1500 --num_data 98000 --lr 0.02 --num_users 10 --norm_layer BatchNorm --freeze_bn_at_round 600 --probe_activs --id tiny_output/tensorboard/resnet18_bn_step500_delay@600_a01.tune_tiny > tiny_output/resnet18_bn_step500_delay@600_a01.tune_tiny.txt
# python3 main_fl_clean.py --dataset tiny --data /fs/scratch/PAS2099/pfl_final/data_/data/tiny-imagenet-200 -a resnet18 --print-freq 100 --steps 500 -b 20 --frac 0.5 --method dir --alpha 0.1 --rounds 1500 --num_data 98000 --lr 0.02 --num_users 10 --norm_layer BatchNorm --freeze_bn_at_round 800 --probe_activs --id tiny_output/tensorboard/resnet18_bn_step500_delay@800_a01.tune_tiny > tiny_output/resnet18_bn_step500_delay@800_a01.tune_tiny.txt
# python3 main_fl_clean.py --dataset tiny --data /fs/scratch/PAS2099/pfl_final/data_/data/tiny-imagenet-200 -a resnet18 --print-freq 100 --steps 500 -b 20 --frac 0.5 --method dir --alpha 0.1 --rounds 1500 --num_data 98000 --lr 0.02 --num_users 10 --norm_layer BatchNorm --freeze_bn_at_round 1000 --probe_activs --id tiny_output/tensorboard/resnet18_bn_step500_delay@1000_a01.tune_tiny > tiny_output/resnet18_bn_step500_delay@1000_a01.tune_tiny.txt
# python3 main_fl_clean.py --dataset tiny --data /fs/scratch/PAS2099/pfl_final/data_/data/tiny-imagenet-200 -a resnet18 --print-freq 100 --steps 500 -b 20 --frac 0.5 --method dir --alpha 0.1 --rounds 1500 --num_data 98000 --lr 0.02 --num_users 10 --norm_layer BatchNorm --freeze_bn_at_round 1400 --probe_activs --id tiny_output/tensorboard/resnet18_bn_step500_delay@1400_a01.tune_tiny > tiny_output/resnet18_bn_step500_delay@1400_a01.tune_tiny.txt


# #
# python3 main_fl_clean.py --dataset tiny --data /fs/scratch/PAS2099/pfl_final/data_/data/tiny-imagenet-200 -a resnet18 --print-freq 100 --steps 100 -b 20 --frac 0.5 --method dir --alpha 0.1 --rounds 1500 --num_data 98000 --lr 0.02 --num_users 10 --norm_layer BatchNorm --freeze_bn_at_round 600 --probe_activs --pretrained /fs/ess/scratch/PAS2099/jike/DelayBN/resnet18_places365.pth.tar --id test_pretrain > tiny_output/test_pretrain.txt

# ##We test freezing BN at different stage for tiny with Pretrain
# python3 main_fl_clean.py --dataset tiny --data /fs/scratch/PAS2099/pfl_final/data_/data/tiny-imagenet-200 -a resnet18 --print-freq 100 --steps 100 -b 20 --frac 0.5 --method dir --alpha 0.1 --rounds 1500 --num_data 98000 --lr 0.002 --num_users 10 --norm_layer BatchNorm --freeze_bn_at_round 1 --probe_activs --pretrained /fs/ess/scratch/PAS2099/jike/DelayBN/resnet18_places365.pth.tar --id tiny_output/tensorboard/resnet18_bn_step100_delay@1_a01.tune_tiny.pretraind > tiny_output/resnet18_bn_step100_delay@1_a01.tune_tiny.pretraind.txt
# python3 main_fl_clean.py --dataset tiny --data /fs/scratch/PAS2099/pfl_final/data_/data/tiny-imagenet-200 -a resnet18 --print-freq 100 --steps 100 -b 20 --frac 0.5 --method dir --alpha 0.1 --rounds 1500 --num_data 98000 --lr 0.002 --num_users 10 --norm_layer BatchNorm --freeze_bn_at_round 0 --probe_activs --pretrained /fs/ess/scratch/PAS2099/jike/DelayBN/resnet18_places365.pth.tar --id tiny_output/tensorboard/resnet18_bn_step100_delay@0_a01.tune_tiny.pretraind > tiny_output/resnet18_bn_step100_delay@0_a01.tune_tiny.pretraind.txt
# python3 main_fl_clean.py --dataset tiny --data /fs/scratch/PAS2099/pfl_final/data_/data/tiny-imagenet-200 -a resnet18 --print-freq 100 --steps 100 -b 20 --frac 0.5 --method dir --alpha 0.1 --rounds 1500 --num_data 98000 --lr 0.002 --num_users 10 --norm_layer BatchNorm --freeze_bn_at_round 200 --probe_activs --pretrained /fs/ess/scratch/PAS2099/jike/DelayBN/resnet18_places365.pth.tar --id tiny_output/tensorboard/resnet18_bn_step100_delay@200_a01.tune_tiny.pretraind > tiny_output/resnet18_bn_step100_delay@200_a01.tune_tiny.pretraind.txt
# python3 main_fl_clean.py --dataset tiny --data /fs/scratch/PAS2099/pfl_final/data_/data/tiny-imagenet-200 -a resnet18 --print-freq 100 --steps 100 -b 20 --frac 0.5 --method dir --alpha 0.1 --rounds 1500 --num_data 98000 --lr 0.002 --num_users 10 --norm_layer BatchNorm --freeze_bn_at_round 400 --probe_activs --pretrained /fs/ess/scratch/PAS2099/jike/DelayBN/resnet18_places365.pth.tar  --id tiny_output/tensorboard/resnet18_bn_step100_delay@400_a01.tune_tiny.pretraind > tiny_output/resnet18_bn_step100_delay@400_a01.tune_tiny.pretraind.txt
# python3 main_fl_clean.py --dataset tiny --data /fs/scratch/PAS2099/pfl_final/data_/data/tiny-imagenet-200 -a resnet18 --print-freq 100 --steps 100 -b 20 --frac 0.5 --method dir --alpha 0.1 --rounds 1500 --num_data 98000 --lr 0.002 --num_users 10 --norm_layer BatchNorm --freeze_bn_at_round 600 --probe_activs --pretrained /fs/ess/scratch/PAS2099/jike/DelayBN/resnet18_places365.pth.tar  --id tiny_output/tensorboard/resnet18_bn_step100_delay@600_a01.tune_tiny.pretraind > tiny_output/resnet18_bn_step100_delay@600_a01.tune_tiny.pretraind.txt
# python3 main_fl_clean.py --dataset tiny --data /fs/scratch/PAS2099/pfl_final/data_/data/tiny-imagenet-200 -a resnet18 --print-freq 100 --steps 100 -b 20 --frac 0.5 --method dir --alpha 0.1 --rounds 1500 --num_data 98000 --lr 0.002 --num_users 10 --norm_layer BatchNorm --freeze_bn_at_round 800 --probe_activs --pretrained /fs/ess/scratch/PAS2099/jike/DelayBN/resnet18_places365.pth.tar  --id tiny_output/tensorboard/resnet18_bn_step100_delay@800_a01.tune_tiny.pretraind > tiny_output/resnet18_bn_step100_delay@800_a01.tune_tiny.pretraind.txt
# python3 main_fl_clean.py --dataset tiny --data /fs/scratch/PAS2099/pfl_final/data_/data/tiny-imagenet-200 -a resnet18 --print-freq 100 --steps 100 -b 20 --frac 0.5 --method dir --alpha 0.1 --rounds 1500 --num_data 98000 --lr 0.002 --num_users 10 --norm_layer BatchNorm --freeze_bn_at_round 1000 --probe_activs --pretrained /fs/ess/scratch/PAS2099/jike/DelayBN/resnet18_places365.pth.tar  --id tiny_output/tensorboard/resnet18_bn_step100_delay@1000_a01.tune_tiny.pretraind > tiny_output/resnet18_bn_step100_delay@1000_a01.tune_tiny.pretraind.txt
# python3 main_fl_clean.py --dataset tiny --data /fs/scratch/PAS2099/pfl_final/data_/data/tiny-imagenet-200 -a resnet18 --print-freq 100 --steps 100 -b 20 --frac 0.5 --method dir --alpha 0.1 --rounds 1500 --num_data 98000 --lr 0.002 --num_users 10 --norm_layer BatchNorm --freeze_bn_at_round 1200 --probe_activs --pretrained /fs/ess/scratch/PAS2099/jike/DelayBN/resnet18_places365.pth.tar  --id tiny_output/tensorboard/resnet18_bn_step100_delay@1200_a01.tune_tiny.pretraind > tiny_output/resnet18_bn_step100_delay@1200_a01.tune_tiny.pretraind.txt
# python3 main_fl_clean.py --dataset tiny --data /fs/scratch/PAS2099/pfl_final/data_/data/tiny-imagenet-200 -a resnet18 --print-freq 100 --steps 100 -b 20 --frac 0.5 --method dir --alpha 0.1 --rounds 1500 --num_data 98000 --lr 0.002 --num_users 10 --norm_layer BatchNorm --freeze_bn_at_round 1400 --probe_activs --pretrained /fs/ess/scratch/PAS2099/jike/DelayBN/resnet18_places365.pth.tar  --id tiny_output/tensorboard/resnet18_bn_step100_delay@1400_a01.tune_tiny.pretraind > tiny_output/resnet18_bn_step100_delay@1400_a01.tune_tiny.pretraind.txt

# python3 main_fl_clean.py --dataset tiny --data /fs/scratch/PAS2099/pfl_final/data_/data/tiny-imagenet-200 -a resnet18 --print-freq 100 --steps 100 -b 20 --frac 0.5 --method dir --alpha 100 --rounds 1500 --num_data 98000 --lr 0.002 --num_users 10 --norm_layer BatchNorm --freeze_bn_at_round 1 --probe_activs --pretrained /fs/ess/scratch/PAS2099/jike/DelayBN/resnet18_places365.pth.tar  --id tiny_output/tensorboard/resnet18_bn_step100_delay@1_a100.tune_tiny.pretraind > tiny_output/resnet18_bn_step100_delay@1_a100.tune_tiny.pretraind.txt
# python3 main_fl_clean.py --dataset tiny --data /fs/scratch/PAS2099/pfl_final/data_/data/tiny-imagenet-200 -a resnet18 --print-freq 100 --steps 100 -b 20 --frac 0.5 --method dir --alpha 100 --rounds 1500 --num_data 98000 --lr 0.002 --num_users 10 --norm_layer BatchNorm --freeze_bn_at_round 0 --probe_activs --pretrained /fs/ess/scratch/PAS2099/jike/DelayBN/resnet18_places365.pth.tar  --id tiny_output/tensorboard/resnet18_bn_step100_delay@0_a100.tune_tiny.pretraind > tiny_output/resnet18_bn_step100_delay@0_a100.tune_tiny.pretraind.txt
# python3 main_fl_clean.py --dataset tiny --data /fs/scratch/PAS2099/pfl_final/data_/data/tiny-imagenet-200 -a resnet18 --print-freq 100 --steps 100 -b 20 --frac 0.5 --method dir --alpha 100 --rounds 1500 --num_data 98000 --lr 0.002 --num_users 10 --norm_layer BatchNorm --freeze_bn_at_round 200 --probe_activs --pretrained /fs/ess/scratch/PAS2099/jike/DelayBN/resnet18_places365.pth.tar  --id tiny_output/tensorboard/resnet18_bn_step100_delay@200_a100.tune_tiny.pretraind > tiny_output/resnet18_bn_step100_delay@200_a100.tune_tiny.pretraind.txt
# python3 main_fl_clean.py --dataset tiny --data /fs/scratch/PAS2099/pfl_final/data_/data/tiny-imagenet-200 -a resnet18 --print-freq 100 --steps 100 -b 20 --frac 0.5 --method dir --alpha 100 --rounds 1500 --num_data 98000 --lr 0.002 --num_users 10 --norm_layer BatchNorm --freeze_bn_at_round 400 --probe_activs --pretrained /fs/ess/scratch/PAS2099/jike/DelayBN/resnet18_places365.pth.tar  --id tiny_output/tensorboard/resnet18_bn_step100_delay@400_a100.tune_tiny.pretraind > tiny_output/resnet18_bn_step100_delay@400_a100.tune_tiny.pretraind.txt
# python3 main_fl_clean.py --dataset tiny --data /fs/scratch/PAS2099/pfl_final/data_/data/tiny-imagenet-200 -a resnet18 --print-freq 100 --steps 100 -b 20 --frac 0.5 --method dir --alpha 100 --rounds 1500 --num_data 98000 --lr 0.002 --num_users 10 --norm_layer BatchNorm --freeze_bn_at_round 600 --probe_activs --pretrained /fs/ess/scratch/PAS2099/jike/DelayBN/resnet18_places365.pth.tar  --id tiny_output/tensorboard/resnet18_bn_step100_delay@600_a100.tune_tiny.pretraind > tiny_output/resnet18_bn_step100_delay@600_a100.tune_tiny.pretraind.txt
# python3 main_fl_clean.py --dataset tiny --data /fs/scratch/PAS2099/pfl_final/data_/data/tiny-imagenet-200 -a resnet18 --print-freq 100 --steps 100 -b 20 --frac 0.5 --method dir --alpha 100 --rounds 1500 --num_data 98000 --lr 0.002 --num_users 10 --norm_layer BatchNorm --freeze_bn_at_round 800 --probe_activs --pretrained /fs/ess/scratch/PAS2099/jike/DelayBN/resnet18_places365.pth.tar  --id tiny_output/tensorboard/resnet18_bn_step100_delay@800_a100.tune_tiny.pretraind > tiny_output/resnet18_bn_step100_delay@800_a100.tune_tiny.pretraind.txt
# python3 main_fl_clean.py --dataset tiny --data /fs/scratch/PAS2099/pfl_final/data_/data/tiny-imagenet-200 -a resnet18 --print-freq 100 --steps 100 -b 20 --frac 0.5 --method dir --alpha 100 --rounds 1500 --num_data 98000 --lr 0.002 --num_users 10 --norm_layer BatchNorm --freeze_bn_at_round 1000 --probe_activs --pretrained /fs/ess/scratch/PAS2099/jike/DelayBN/resnet18_places365.pth.tar  --id tiny_output/tensorboard/resnet18_bn_step100_delay@1000_a100.tune_tiny.pretraind > tiny_output/resnet18_bn_step100_delay@1000_a100.tune_tiny.pretraind.txt
# python3 main_fl_clean.py --dataset tiny --data /fs/scratch/PAS2099/pfl_final/data_/data/tiny-imagenet-200 -a resnet18 --print-freq 100 --steps 100 -b 20 --frac 0.5 --method dir --alpha 100 --rounds 1500 --num_data 98000 --lr 0.002 --num_users 10 --norm_layer BatchNorm --freeze_bn_at_round 1200 --probe_activs --pretrained /fs/ess/scratch/PAS2099/jike/DelayBN/resnet18_places365.pth.tar  --id tiny_output/tensorboard/resnet18_bn_step100_delay@1200_a100.tune_tiny.pretraind > tiny_output/resnet18_bn_step100_delay@1200_a100.tune_tiny.pretraind.txt
# python3 main_fl_clean.py --dataset tiny --data /fs/scratch/PAS2099/pfl_final/data_/data/tiny-imagenet-200 -a resnet18 --print-freq 100 --steps 100 -b 20 --frac 0.5 --method dir --alpha 100 --rounds 1500 --num_data 98000 --lr 0.002 --num_users 10 --norm_layer BatchNorm --freeze_bn_at_round 1400 --probe_activs --pretrained /fs/ess/scratch/PAS2099/jike/DelayBN/resnet18_places365.pth.tar  --id tiny_output/tensorboard/resnet18_bn_step100_delay@1400_a100.tune_tiny.pretraind > tiny_output/resnet18_bn_step100_delay@1400_a100.tune_tiny.pretraind.txt


# ##We test freezing BN at different stage with smaller lr
# python3 main_fl_clean.py --dataset tiny --data /fs/scratch/PAS2099/pfl_final/data_/data/tiny-imagenet-200 -a resnet18 --print-freq 100 --steps 100 -b 20 --frac 0.5 --method dir --alpha 0.1 --rounds 1500 --num_data 98000 --lr 0.002 --num_users 10 --norm_layer BatchNorm --freeze_bn_at_round 0 --probe_activs --pretrained /fs/ess/scratch/PAS2099/jike/DelayBN/resnet18_places365.pth.tar --id tiny_output/tensorboard/resnet18_bn_step100_delay@0_a01.tune_tiny.pretraind.smalllr > tiny_output/resnet18_bn_step100_delay@0_a01.tune_tiny.pretraind.smalllr.txt
# python3 main_fl_clean.py --dataset tiny --data /fs/scratch/PAS2099/pfl_final/data_/data/tiny-imagenet-200 -a resnet18 --print-freq 100 --steps 100 -b 20 --frac 0.5 --method dir --alpha 0.1 --rounds 1500 --num_data 98000 --lr 0.002 --num_users 10 --norm_layer BatchNorm --freeze_bn_at_round 200 --probe_activs --pretrained /fs/ess/scratch/PAS2099/jike/DelayBN/resnet18_places365.pth.tar --id tiny_output/tensorboard/resnet18_bn_step100_delay@200_a01.tune_tiny.pretraind.smalllr > tiny_output/resnet18_bn_step100_delay@200_a01.tune_tiny.pretraind.smalllr.txt
# python3 main_fl_clean.py --dataset tiny --data /fs/scratch/PAS2099/pfl_final/data_/data/tiny-imagenet-200 -a resnet18 --print-freq 100 --steps 100 -b 20 --frac 0.5 --method dir --alpha 0.1 --rounds 1500 --num_data 98000 --lr 0.002 --num_users 10 --norm_layer BatchNorm --freeze_bn_at_round 400 --probe_activs --pretrained /fs/ess/scratch/PAS2099/jike/DelayBN/resnet18_places365.pth.tar  --id tiny_output/tensorboard/resnet18_bn_step100_delay@400_a01.tune_tiny.pretraind.smalllr > tiny_output/resnet18_bn_step100_delay@400_a01.tune_tiny.pretraind.smallr.txt
# python3 main_fl_clean.py --dataset tiny --data /fs/scratch/PAS2099/pfl_final/data_/data/tiny-imagenet-200 -a resnet18 --print-freq 100 --steps 100 -b 20 --frac 0.5 --method dir --alpha 0.1 --rounds 1500 --num_data 98000 --lr 0.002 --num_users 10 --norm_layer BatchNorm --freeze_bn_at_round 600 --probe_activs --pretrained /fs/ess/scratch/PAS2099/jike/DelayBN/resnet18_places365.pth.tar  --id tiny_output/tensorboard/resnet18_bn_step100_delay@600_a01.tune_tiny.pretraind.smalllr > tiny_output/resnet18_bn_step100_delay@600_a01.tune_tiny.pretraind.smallr.txt
# python3 main_fl_clean.py --dataset tiny --data /fs/scratch/PAS2099/pfl_final/data_/data/tiny-imagenet-200 -a resnet18 --print-freq 100 --steps 100 -b 20 --frac 0.5 --method dir --alpha 0.1 --rounds 1500 --num_data 98000 --lr 0.002 --num_users 10 --norm_layer BatchNorm --freeze_bn_at_round 800 --probe_activs --pretrained /fs/ess/scratch/PAS2099/jike/DelayBN/resnet18_places365.pth.tar  --id tiny_output/tensorboard/resnet18_bn_step100_delay@800_a01.tune_tiny.pretraind.smalllr > tiny_output/resnet18_bn_step100_delay@800_a01.tune_tiny.pretraindsmallr.txt
# python3 main_fl_clean.py --dataset tiny --data /fs/scratch/PAS2099/pfl_final/data_/data/tiny-imagenet-200 -a resnet18 --print-freq 100 --steps 100 -b 20 --frac 0.5 --method dir --alpha 0.1 --rounds 1500 --num_data 98000 --lr 0.002 --num_users 10 --norm_layer BatchNorm --freeze_bn_at_round 1000 --probe_activs --pretrained /fs/ess/scratch/PAS2099/jike/DelayBN/resnet18_places365.pth.tar  --id tiny_output/tensorboard/resnet18_bn_step100_delay@1000_a01.tune_tiny.pretraind.smalllr > tiny_output/resnet18_bn_step100_delay@1000_a01.tune_tiny.pretraind.smallr.txt
# python3 main_fl_clean.py --dataset tiny --data /fs/scratch/PAS2099/pfl_final/data_/data/tiny-imagenet-200 -a resnet18 --print-freq 100 --steps 100 -b 20 --frac 0.5 --method dir --alpha 0.1 --rounds 1500 --num_data 98000 --lr 0.002 --num_users 10 --norm_layer BatchNorm --freeze_bn_at_round 1200 --probe_activs --pretrained /fs/ess/scratch/PAS2099/jike/DelayBN/resnet18_places365.pth.tar  --id tiny_output/tensorboard/resnet18_bn_step100_delay@1200_a01.tune_tiny.pretraind.smalllr > tiny_output/resnet18_bn_step100_delay@1200_a01.tune_tiny.pretraind.smallr.txt
# python3 main_fl_clean.py --dataset tiny --data /fs/scratch/PAS2099/pfl_final/data_/data/tiny-imagenet-200 -a resnet18 --print-freq 100 --steps 100 -b 20 --frac 0.5 --method dir --alpha 0.1 --rounds 1500 --num_data 98000 --lr 0.002 --num_users 10 --norm_layer BatchNorm --freeze_bn_at_round 1400 --probe_activs --pretrained /fs/ess/scratch/PAS2099/jike/DelayBN/resnet18_places365.pth.tar  --id tiny_output/tensorboard/resnet18_bn_step100_delay@1400_a01.tune_tiny.pretraind.smalllr > tiny_output/resnet18_bn_step100_delay@1400_a01.tune_tiny.pretraind.smallr.txt

# python3 main_fl_clean.py --dataset tiny --data /fs/scratch/PAS2099/pfl_final/data_/data/tiny-imagenet-200 -a resnet18 --print-freq 100 --steps 100 -b 20 --frac 0.5 --method dir --alpha 100 --rounds 1500 --num_data 98000 --lr 0.002 --num_users 10 --norm_layer BatchNorm --freeze_bn_at_round 0 --probe_activs --pretrained /fs/ess/scratch/PAS2099/jike/DelayBN/resnet18_places365.pth.tar  --id tiny_output/tensorboard/resnet18_bn_step100_delay@0_a100.tune_tiny.pretraind.smalllr > tiny_output/resnet18_bn_step100_delay@0_a100.tune_tiny.pretraind.smalllr.txt
# python3 main_fl_clean.py --dataset tiny --data /fs/scratch/PAS2099/pfl_final/data_/data/tiny-imagenet-200 -a resnet18 --print-freq 100 --steps 100 -b 20 --frac 0.5 --method dir --alpha 100 --rounds 1500 --num_data 98000 --lr 0.002 --num_users 10 --norm_layer BatchNorm --freeze_bn_at_round 400 --probe_activs --pretrained /fs/ess/scratch/PAS2099/jike/DelayBN/resnet18_places365.pth.tar  --id tiny_output/tensorboard/resnet18_bn_step100_delay@400_a100.tune_tiny.pretraind > tiny_output/resnet18_bn_step100_delay@400_a100.tune_tiny.pretraind.txt
# python3 main_fl_clean.py --dataset tiny --data /fs/scratch/PAS2099/pfl_final/data_/data/tiny-imagenet-200 -a resnet18 --print-freq 100 --steps 100 -b 20 --frac 0.5 --method dir --alpha 100 --rounds 1500 --num_data 98000 --lr 0.002 --num_users 10 --norm_layer BatchNorm --freeze_bn_at_round 800 --probe_activs --pretrained /fs/ess/scratch/PAS2099/jike/DelayBN/resnet18_places365.pth.tar  --id tiny_output/tensorboard/resnet18_bn_step100_delay@800_a100.tune_tiny.pretraind > tiny_output/resnet18_bn_step100_delay@800_a100.tune_tiny.pretraind.txt
# python3 main_fl_clean.py --dataset tiny --data /fs/scratch/PAS2099/pfl_final/data_/data/tiny-imagenet-200 -a resnet18 --print-freq 100 --steps 100 -b 20 --frac 0.5 --method dir --alpha 100 --rounds 1500 --num_data 98000 --lr 0.002 --num_users 10 --norm_layer BatchNorm --freeze_bn_at_round 1200 --probe_activs --pretrained /fs/ess/scratch/PAS2099/jike/DelayBN/resnet18_places365.pth.tar  --id tiny_output/tensorboard/resnet18_bn_step100_delay@1200_a100.tune_tiny.pretraind > tiny_output/resnet18_bn_step100_delay@1200_a100.tune_tiny.pretraind.txt

# #we test larger or small lr
# python3 main_fl_clean.py --dataset tiny --data /fs/scratch/PAS2099/pfl_final/data_/data/tiny-imagenet-200 -a resnet18 --print-freq 100 --steps 100 -b 20 --frac 0.5 --method dir --alpha 0.1 --rounds 1500 --num_data 98000 --lr 0.2 --num_users 10 --norm_layer BatchNorm --freeze_bn_at_round 200 --probe_activs --id tiny_output/tensorboard/resnet18_bn_step100_delay@200_a01.tune_tiny.lr0.2 > tiny_output/resnet18_bn_step100_delay@200_a01.tune_tiny.lr0.2.txt
# python3 main_fl_clean.py --dataset tiny --data /fs/scratch/PAS2099/pfl_final/data_/data/tiny-imagenet-200 -a resnet18 --print-freq 100 --steps 100 -b 20 --frac 0.5 --method dir --alpha 0.1 --rounds 1500 --num_data 98000 --lr 0.2 --num_users 10 --norm_layer BatchNorm --freeze_bn_at_round 400 --probe_activs --id tiny_output/tensorboard/resnet18_bn_step100_delay@400_a01.tune_tiny.lr0.2 > tiny_output/resnet18_bn_step100_delay@400_a01.tune_tiny.lr0.2.txt
# python3 main_fl_clean.py --dataset tiny --data /fs/scratch/PAS2099/pfl_final/data_/data/tiny-imagenet-200 -a resnet18 --print-freq 100 --steps 100 -b 20 --frac 0.5 --method dir --alpha 0.1 --rounds 1500 --num_data 98000 --lr 0.2 --num_users 10 --norm_layer BatchNorm --freeze_bn_at_round 600 --probe_activs --id tiny_output/tensorboard/resnet18_bn_step100_delay@600_a01.tune_tiny.lr0.2 > tiny_output/resnet18_bn_step100_delay@600_a01.tune_tiny.lr0.2.txt
# python3 main_fl_clean.py --dataset tiny --data /fs/scratch/PAS2099/pfl_final/data_/data/tiny-imagenet-200 -a resnet18 --print-freq 100 --steps 100 -b 20 --frac 0.5 --method dir --alpha 0.1 --rounds 1500 --num_data 98000 --lr 0.2 --num_users 10 --norm_layer BatchNorm --freeze_bn_at_round 800 --probe_activs --id tiny_output/tensorboard/resnet18_bn_step100_delay@800_a01.tune_tiny.lr0.2 > tiny_output/resnet18_bn_step100_delay@800_a01.tune_tiny.lr0.2.txt
# python3 main_fl_clean.py --dataset tiny --data /fs/scratch/PAS2099/pfl_final/data_/data/tiny-imagenet-200 -a resnet18 --print-freq 100 --steps 100 -b 20 --frac 0.5 --method dir --alpha 0.1 --rounds 1500 --num_data 98000 --lr 0.2 --num_users 10 --norm_layer BatchNorm --freeze_bn_at_round 1000 --probe_activs --id tiny_output/tensorboard/resnet18_bn_step100_delay@1000_a01.tune_tiny.lr0.2 > tiny_output/resnet18_bn_step100_delay@1000_a01.tune_tiny.lr0.2.txt
# python3 main_fl_clean.py --dataset tiny --data /fs/scratch/PAS2099/pfl_final/data_/data/tiny-imagenet-200 -a resnet18 --print-freq 100 --steps 100 -b 20 --frac 0.5 --method dir --alpha 0.1 --rounds 1500 --num_data 98000 --lr 0.2 --num_users 10 --norm_layer BatchNorm --freeze_bn_at_round 1200 --probe_activs --id tiny_output/tensorboard/resnet18_bn_step100_delay@1200_a01.tune_tiny.lr0.2 > tiny_output/resnet18_bn_step100_delay@1200_a01.tune_tiny.lr0.2.txt
# python3 main_fl_clean.py --dataset tiny --data /fs/scratch/PAS2099/pfl_final/data_/data/tiny-imagenet-200 -a resnet18 --print-freq 100 --steps 100 -b 20 --frac 0.5 --method dir --alpha 0.1 --rounds 1500 --num_data 98000 --lr 0.2 --num_users 10 --norm_layer BatchNorm --freeze_bn_at_round 1400 --probe_activs --id tiny_output/tensorboard/resnet18_bn_step100_delay@1400_a01.tune_tiny.lr0.2 > tiny_output/resnet18_bn_step100_delay@1400_a01.tune_tiny.lr0.2.txt


# python3 main_fl_clean.py --dataset tiny --data /fs/scratch/PAS2099/pfl_final/data_/data/tiny-imagenet-200 -a resnet18 --print-freq 100 --steps 100 -b 20 --frac 0.5 --method dir --alpha 0.1 --rounds 1500 --num_data 98000 --lr 0.002 --num_users 10 --norm_layer BatchNorm --freeze_bn_at_round 200 --probe_activs --id tiny_output/tensorboard/resnet18_bn_step100_delay@200_a01.tune_tiny.lr0.002 > tiny_output/resnet18_bn_step100_delay@200_a01.tune_tiny.lr0.002.txt
# python3 main_fl_clean.py --dataset tiny --data /fs/scratch/PAS2099/pfl_final/data_/data/tiny-imagenet-200 -a resnet18 --print-freq 100 --steps 100 -b 20 --frac 0.5 --method dir --alpha 0.1 --rounds 1500 --num_data 98000 --lr 0.002 --num_users 10 --norm_layer BatchNorm --freeze_bn_at_round 400 --probe_activs --id tiny_output/tensorboard/resnet18_bn_step100_delay@400_a01.tune_tiny.lr0.002 > tiny_output/resnet18_bn_step100_delay@400_a01.tune_tiny.lr0.002.txt
# python3 main_fl_clean.py --dataset tiny --data /fs/scratch/PAS2099/pfl_final/data_/data/tiny-imagenet-200 -a resnet18 --print-freq 100 --steps 100 -b 20 --frac 0.5 --method dir --alpha 0.1 --rounds 1500 --num_data 98000 --lr 0.002 --num_users 10 --norm_layer BatchNorm --freeze_bn_at_round 600 --probe_activs --id tiny_output/tensorboard/resnet18_bn_step100_delay@600_a01.tune_tiny.lr0.002 > tiny_output/resnet18_bn_step100_delay@600_a01.tune_tiny.lr0.002.txt
# python3 main_fl_clean.py --dataset tiny --data /fs/scratch/PAS2099/pfl_final/data_/data/tiny-imagenet-200 -a resnet18 --print-freq 100 --steps 100 -b 20 --frac 0.5 --method dir --alpha 0.1 --rounds 1500 --num_data 98000 --lr 0.002 --num_users 10 --norm_layer BatchNorm --freeze_bn_at_round 800 --probe_activs --id tiny_output/tensorboard/resnet18_bn_step100_delay@800_a01.tune_tiny.lr0.002 > tiny_output/resnet18_bn_step100_delay@800_a01.tune_tiny.lr0.002.txt
# python3 main_fl_clean.py --dataset tiny --data /fs/scratch/PAS2099/pfl_final/data_/data/tiny-imagenet-200 -a resnet18 --print-freq 100 --steps 100 -b 20 --frac 0.5 --method dir --alpha 0.1 --rounds 1500 --num_data 98000 --lr 0.002 --num_users 10 --norm_layer BatchNorm --freeze_bn_at_round 1000 --probe_activs --id tiny_output/tensorboard/resnet18_bn_step100_delay@1000_a01.tune_tiny.lr0.002 > tiny_output/resnet18_bn_step100_delay@1000_a01.tune_tiny.lr0.002.txt
# python3 main_fl_clean.py --dataset tiny --data /fs/scratch/PAS2099/pfl_final/data_/data/tiny-imagenet-200 -a resnet18 --print-freq 100 --steps 100 -b 20 --frac 0.5 --method dir --alpha 0.1 --rounds 1500 --num_data 98000 --lr 0.002 --num_users 10 --norm_layer BatchNorm --freeze_bn_at_round 1200 --probe_activs --id tiny_output/tensorboard/resnet18_bn_step100_delay@1200_a01.tune_tiny.lr0.002 > tiny_output/resnet18_bn_step100_delay@1200_a01.tune_tiny.lr0.002.txt
# python3 main_fl_clean.py --dataset tiny --data /fs/scratch/PAS2099/pfl_final/data_/data/tiny-imagenet-200 -a resnet18 --print-freq 100 --steps 100 -b 20 --frac 0.5 --method dir --alpha 0.1 --rounds 1500 --num_data 98000 --lr 0.002 --num_users 10 --norm_layer BatchNorm --freeze_bn_at_round 1400 --probe_activs --id tiny_output/tensorboard/resnet18_bn_step100_delay@1400_a01.tune_tiny.lr0.002 > tiny_output/resnet18_bn_step100_delay@1400_a01.tune_tiny.lr0.002.txt



# #test
# python3 main_fl_clean.py --dataset cifar10 -a resnet18 --print-freq 100 --steps 20 -b 20 --frac 0.5 --method dir --alpha 0.1 --rounds 3200 --freeze_bn_at_round 1600 --num_classes 10 --num_data 49000 --lr 0.02 --num_users 10 --norm_layer BatchNorm --probe_activs --id test




# #BN params
# # local mom
# python3 main_fl_clean_step1_local_mom.py --dataset cifar10 -a resnet20 --print-freq 100 --steps 1  -b 20 --frac 1 --method step --alpha 0 --rounds 64000 --num_data 49000 --lr 0.2 --num_users 5 --freeze_bn_at_round 32000 --norm_layer BatchNorm --log_every_round 200 --freeze_bn_params --id final_poll_ablation/tensorboard/DelayBN_noactivs_step_1_freeze_bn_params_new > final_poll_ablation/DelayBN_noactivs_step_1_freeze_bn_params_new.txt
# python3 main_fl_clean_local_mom_fast.py --dataset cifar10 -a resnet20 --print-freq 100 --steps 20  -b 20 --frac 1 --method step --alpha 0 --rounds 3200 --num_data 49000 --lr 0.02 --num_users 5 --freeze_bn_at_round 1600 --norm_layer BatchNorm --log_every_round 10 --freeze_bn_params --id final_poll_ablation/tensorboard/DelayBN_noactivs_step_20_freeze_bn_params > final_poll_ablation/DelayBN_noactivs_step_20_freeze_bn_params.txt
# python3 main_fl_clean_local_mom_fast.py --dataset cifar10 -a resnet20 --print-freq 100 --steps 100  -b 20 --frac 1 --method step --alpha 0 --rounds 640 --num_data 49000 --lr 0.02 --num_users 5 --freeze_bn_at_round 320 --norm_layer BatchNorm --log_every_round 1 --freeze_bn_params --id final_poll_ablation/tensorboard/DelayBN_noactivs_step_100_freeze_bn_params_2 > final_poll_ablation/DelayBN_noactivs_step_100_shards_freeze_bn_params_2.txt
# python3 main_fl_clean_local_mom_fast.py --dataset cifar10 -a resnet20 --print-freq 100 --steps 500  -b 20 --frac 1 --method step --alpha 0 --rounds 128 --num_data 49000 --lr 0.02 --num_users 5 --freeze_bn_at_round 64 --norm_layer BatchNorm --log_every_round 1 --freeze_bn_params --id final_poll_ablation/tensorboard/DelayBN_noactivs_step_500_freeze_bn_params > final_poll_ablation/DelayBN_noactivs_step_500_shards_freeze_bn_params.txt
# python3 main_fl_clean_local_mom_fast.py --dataset cifar10 -a resnet20 --print-freq 100 --steps 2500  -b 20 --frac 1 --method step --alpha 0 --rounds 26 --num_data 49000 --lr 0.02 --num_users 5 --freeze_bn_at_round 13 --norm_layer BatchNorm --log_every_round 1 --freeze_bn_params --id final_poll_ablation/tensorboard/DelayBN_noactivs_step_2500_freeze_bn_params > final_poll_ablation/DelayBN_noactivs_step_2500_shards_freeze_bn_params.txt

#GN Different Group Size
# python3 main_fl_clean_step1_local_mom.py --dataset cifar10 -a resnet20 --print-freq 100 --steps 1  -b 20 --frac 1 --method step --alpha 0 --rounds 64000 --num_data 49000 --lr 0.2 --num_users 5  --norm_layer GroupNorm --log_every_round 200 --id final_poll_ablation/tensorboard/DelayBN_noactivs_step_1_GN_1 > final_poll_ablation/DelayBN_noactivs_step_1_GN_1.txt
# python3 main_fl_clean_step1_local_mom.py --dataset cifar10 -a resnet20 --print-freq 100 --steps 1  -b 20 --frac 1 --method step --alpha 0 --rounds 64000 --num_data 49000 --lr 0.2 --num_users 5  --norm_layer GroupNorm --log_every_round 200 --id final_poll_ablation/tensorboard/DelayBN_noactivs_step_1_GN_2 > final_poll_ablation/DelayBN_noactivs_step_1_GN_2.txt
# python3 main_fl_clean_step1_local_mom.py --dataset cifar10 -a resnet20 --print-freq 100 --steps 1  -b 20 --frac 1 --method step --alpha 0 --rounds 64000 --num_data 49000 --lr 0.2 --num_users 5  --norm_layer GroupNorm --log_every_round 200 --id final_poll_ablation/tensorboard/DelayBN_noactivs_step_1_GN_4 > final_poll_ablation/DelayBN_noactivs_step_1_GN_4.txt
# python3 main_fl_clean_step1_local_mom.py --dataset cifar10 -a resnet20 --print-freq 100 --steps 1  -b 20 --frac 1 --method step --alpha 0 --rounds 64000 --num_data 49000 --lr 0.2 --num_users 5  --norm_layer GroupNorm --log_every_round 200 --id final_poll_ablation/tensorboard/DelayBN_noactivs_step_1_GN_8_2 > final_poll_ablation/DelayBN_noactivs_step_1_GN_8_2.txt
# python3 main_fl_clean_step1_local_mom.py --dataset cifar10 -a resnet20 --print-freq 100 --steps 1  -b 20 --frac 1 --method step --alpha 0 --rounds 64000 --num_data 49000 --lr 0.2 --num_users 5  --norm_layer GroupNorm --log_every_round 200 --id final_poll_ablation/tensorboard/DelayBN_noactivs_step_1_GN_16 > final_poll_ablation/DelayBN_noactivs_step_1_GN_16.txt




# python3 main_fl_clean.py --dataset cifar10 -a resnet20 --print-freq 100 --steps 100  -b 20 --frac 1 --method step --alpha 0 --rounds 640 --num_data 49000 --lr 0.02 --num_users 5  --norm_layer GroupNorm --log_every_round 5 --id final_poll_ablation/tensorboard/DelayBN_noactivs_step_100_GN_1 > final_poll_ablation/DelayBN_noactivs_step_100_GN_1.txt
# python3 main_fl_clean.py --dataset cifar10 -a resnet20 --print-freq 100 --steps 100  -b 20 --frac 1 --method step --alpha 0 --rounds 640 --num_data 49000 --lr 0.02 --num_users 5  --norm_layer GroupNorm --log_every_round 5 --id final_poll_ablation/tensorboard/DelayBN_noactivs_step_100_GN_2 > final_poll_ablation/DelayBN_noactivs_step_100_GN_2.txt
# python3 main_fl_clean.py --dataset cifar10 -a resnet20 --print-freq 100 --steps 100  -b 20 --frac 1 --method step --alpha 0 --rounds 640 --num_data 49000 --lr 0.02 --num_users 5  --norm_layer GroupNorm --log_every_round 5 --id final_poll_ablation/tensorboard/DelayBN_noactivs_step_100_GN_4 > final_poll_ablation/DelayBN_noactivs_step_100_GN_4.txt
# python3 main_fl_clean.py --dataset cifar10 -a resnet20 --print-freq 100 --steps 100  -b 20 --frac 1 --method step --alpha 0 --rounds 640 --num_data 49000 --lr 0.02 --num_users 5  --norm_layer GroupNorm --log_every_round 5 --id final_poll_ablation/tensorboard/DelayBN_noactivs_step_100_GN_8 > final_poll_ablation/DelayBN_noactivs_step_100_GN_8.txt
# python3 main_fl_clean.py --dataset cifar10 -a resnet20 --print-freq 100 --steps 100  -b 20 --frac 1 --method step --alpha 0 --rounds 640 --num_data 49000 --lr 0.02 --num_users 5  --norm_layer GroupNorm --log_every_round 5 --id final_poll_ablation/tensorboard/DelayBN_noactivs_step_100_GN_16 > final_poll_ablation/DelayBN_noactivs_step_100_GN_16.txt

# python3 main_fl_clean.py --dataset cifar10 -a resnet20 --print-freq 100 --steps 100  -b 20 --frac 1 --method step --alpha 0 --rounds 640 --num_data 49000 --lr 0.02 --num_users 5  --norm_layer GroupNorm --log_every_round 5 --id final_poll_ablation/tensorboard/DelayBN_noactivs_step_100_GN_1_2 > final_poll_ablation/DelayBN_noactivs_step_100_GN_1_2.txt
# python3 main_fl_clean.py --dataset cifar10 -a resnet20 --print-freq 100 --steps 100  -b 20 --frac 1 --method step --alpha 0 --rounds 640 --num_data 49000 --lr 0.02 --num_users 5  --norm_layer GroupNorm --log_every_round 5 --id final_poll_ablation/tensorboard/DelayBN_noactivs_step_100_GN_2_2 > final_poll_ablation/DelayBN_noactivs_step_100_GN_2_2.txt
# python3 main_fl_clean.py --dataset cifar10 -a resnet20 --print-freq 100 --steps 100  -b 20 --frac 1 --method step --alpha 0 --rounds 640 --num_data 49000 --lr 0.02 --num_users 5  --norm_layer GroupNorm --log_every_round 5 --id final_poll_ablation/tensorboard/DelayBN_noactivs_step_100_GN_4_2 > final_poll_ablation/DelayBN_noactivs_step_100_GN_4_2.txt
# python3 main_fl_clean.py --dataset cifar10 -a resnet20 --print-freq 100 --steps 100  -b 20 --frac 1 --method step --alpha 0 --rounds 640 --num_data 49000 --lr 0.02 --num_users 5  --norm_layer GroupNorm --log_every_round 5 --id final_poll_ablation/tensorboard/DelayBN_noactivs_step_100_GN_8_2 > final_poll_ablation/DelayBN_noactivs_step_100_GN_8_2.txt
# python3 main_fl_clean.py --dataset cifar10 -a resnet20 --print-freq 100 --steps 100  -b 20 --frac 1 --method step --alpha 0 --rounds 640 --num_data 49000 --lr 0.02 --num_users 5  --norm_layer GroupNorm --log_every_round 5 --id final_poll_ablation/tensorboard/DelayBN_noactivs_step_100_GN_16_2 > final_poll_ablation/DelayBN_noactivs_step_100_GN_16_2.txt



python3 main_fl_clean.py --dataset cifar10 -a resnet20 --print-freq 100 --steps 100  -b 20 --frac 1 --method step --alpha 0 --rounds 640 --num_data 49000 --lr 0.02 --num_users 5 --freeze_bn_at_round 320 --norm_layer BatchNorm --log_every_round 20 --freeze_bn_params --id final_poll_ablation/tensorboard/DelayBN_noactivs_step_100_freeze_paramxx > final_poll_ablation/DelayBN_noactivs_step_100_freeze_paramxx.txt
# python3 main_fl_clean_local_mom_fast.py --dataset cifar10 -a resnet20 --print-freq 100 --steps 100  -b 20 --frac 1 --method step --alpha 0 --rounds 640 --num_data 49000 --lr 0.02 --num_users 5 --freeze_bn_at_round 320 --norm_layer BatchNorm --log_every_round 20 --freeze_bn_params --id final_poll_ablation/tensorboard/DelayBN_noactivs_step_100_freeze_both2 > final_poll_ablation/DelayBN_noactivs_step_100_freeze_both2.txt

# python3 main_fl_clean_local_mom.py --dataset tiny --data /fs/scratch/PAS2099/pfl_final/data_/data/tiny-imagenet-200 -a resnet18 --print-freq 100 --steps 100 -b 20 --frac 0.5 --method step --alpha 0 --rounds 1255 --num_data 98000 --lr 0.02 --num_users 10 --norm_layer BatchNorm --freeze_bn_at_round 640 --log_every_round 50 --id final_poll_ablation/tensorboard/tiny_freeze_both > final_poll_tiny/tiny_freeze_both.txt




